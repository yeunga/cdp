<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/**
<span class='line'>  2</span>  * @class VOView object for filtering and displaying VOTABLEs. This object acts as the
<span class='line'>  3</span>  * namespace for voview, as well as the base object which other objects inherit
<span class='line'>  4</span>  * methods from.
<span class='line'>  5</span>  * 
<span class='line'>  6</span>  * @returns {voview}
<span class='line'>  7</span>  */</span><span class="WHIT">
<span class='line'>  8</span> 
<span class='line'>  9</span> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">voview</span><span class="PUNC">(</span><span class="NAME">vovParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">meVoview</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vovParams.input</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="WHIT">    </span><span class="NAME">this.votableUrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 13</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">proxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"/cgi-bin/vo/util/proxy.pl"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 14</span> </span><span class="WHIT">    </span><span class="NAME">this.filterObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meVoview.makeFilter</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 15</span> </span><span class="WHIT">    </span><span class="NAME">this.renderObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meVoview.makeRenderer</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">filterObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.filterObject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vovParams</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">vovParams</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 16</span> 
<span class='line'> 17</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gotVotable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="WHIT">        </span><span class="NAME">meVoview.filterObject.setInputTable</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">tableDOM</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">        </span><span class="NAME">meVoview.renderObject.render</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">renderCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">meVoview.renderObject.displayHTML</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 21</span> 
<span class='line'> 22</span> </span><span class="WHIT">    </span><span class="NAME">this.start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">urlForm</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">inputParams.form</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="WHIT">            </span><span class="NAME">urlForm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementsByName</span><span class="PUNC">(</span><span class="NAME">inputParams.form</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">            </span><span class="NAME">meVoview.votableUrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">urlForm.query_string.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 28</span> 
<span class='line'> 29</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">urlForm.sort_column</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">                </span><span class="NAME">keys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">                </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meVoview.makeSortColumnKey</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">urlForm.sort_column.value</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">                    </span><span class="NAME">direction</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">urlForm.sort_order.value</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">                </span><span class="NAME">keys.push</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">                </span><span class="NAME">meVoview.filterObject.setSortColumns</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">sortKeys</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">inputParams.url</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">                </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"No input information specified."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">                </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"No input information specified."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">            </span><span class="NAME">meVoview.votableUrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">inputParams.url</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 43</span> 
<span class='line'> 44</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">meVoview.votableUrl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">proxy</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">meVoview.votableUrl.match</span><span class="PUNC">(</span><span class="REGX">/^\w+:/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">                </span><span class="COMM">// Need to use a proxy for downloading the table</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">                </span><span class="NAME">meVoview.votableUrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">proxy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"?"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">encodeURIComponent</span><span class="PUNC">(</span><span class="NAME">meVoview.votableUrl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tableGet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meVoview.makeGetXslt</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">meVoview.votableUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataCallBack</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">gotVotable</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">            </span><span class="NAME">tableGet.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="WHIT">            </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"No input data available."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"No input data available."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 58</span> 
<span class='line'> 59</span> </span><span class="NAME">voview.prototype.makeSortColumnKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sortColParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'> 61</span>      * An object for specifying the data needed for filtering the table by the
<span class='line'> 62</span>      * values in a column.
<span class='line'> 63</span>      * 
<span class='line'> 64</span>      * @param {string|integer} sortColParams.column The column to use for
<span class='line'> 65</span>      *            sorting the table. If a string, specifies the name of the
<span class='line'> 66</span>      *            column. If an integer, the number corresponds to the column in
<span class='line'> 67</span>      *            the original order of the columns in the VOTABLE.
<span class='line'> 68</span>      * 
<span class='line'> 69</span>      * @param {string} sortColParams.direction Sort direction. Either
<span class='line'> 70</span>      *            "ascending" or "descending".
<span class='line'> 71</span>      */</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">SortColumnKey</span><span class="PUNC">(</span><span class="NAME">_column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_direction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">meSortColumnKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">        </span><span class="NAME">meSortColumnKey.column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_column</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">        </span><span class="NAME">meSortColumnKey.direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_direction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 76</span> 
<span class='line'> 77</span> </span><span class="WHIT">        </span><span class="NAME">this.equals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">otherKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">otherKey.column</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">meSortColumnKey.column</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">otherKey.direction</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">meSortColumnKey.direction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">SortColumnKey</span><span class="PUNC">(</span><span class="NAME">sortColParams.column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sortColParams.direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 83</span> 
<span class='line'> 84</span> </span><span class="NAME">voview.prototype.makeColumnFilterKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">filteKeyParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'> 86</span>      * An object for specifying the data needed for filtering the table by the
<span class='line'> 87</span>      * values in a column.
<span class='line'> 88</span>      * 
<span class='line'> 89</span>      * @param filteKeyParams.column {string|integer} The column to use for
<span class='line'> 90</span>      *            filtering the table. If a string, specifies the name of the
<span class='line'> 91</span>      *            column. If an integer, the number corresponds to the column in
<span class='line'> 92</span>      *            the original order of the columns in the VOTABLE.
<span class='line'> 93</span>      * 
<span class='line'> 94</span>      * @param filteKeyParams.expression {string} The filtering expression to be
<span class='line'> 95</span>      *            applied to the column.
<span class='line'> 96</span>      * 
<span class='line'> 97</span>      * @param filteKeyParams.isCharType {boolean} Indicates if the column is a
<span class='line'> 98</span>      *            Character type, rather than numerically valued.
<span class='line'> 99</span>      */</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">columnFilterKey</span><span class="PUNC">(</span><span class="NAME">_column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_expression</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_isCharType</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">meColumnFilterKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">        </span><span class="NAME">meColumnFilterKey.column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_column</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">        </span><span class="NAME">meColumnFilterKey.expression</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_expression</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">        </span><span class="NAME">meColumnFilterKey.isCharType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_isCharType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>105</span> 
<span class='line'>106</span> </span><span class="WHIT">        </span><span class="NAME">this.equals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">otherKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">otherKey.column</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">meColumnFilterKey.column</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">otherKey.expression</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">meColumnFilterKey.expression</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">otherKey.isCharType</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">meColumnFilterKey.isCharType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">columnFilterKey</span><span class="PUNC">(</span><span class="NAME">filteKeyParams.column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filteKeyParams.expression</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filteKeyParams.isCharType</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>111</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>112</span> 
<span class='line'>113</span> </span><span class="NAME">voview.prototype.makeGetXslt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">getXsltParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">GetXslt</span><span class="PUNC">(</span><span class="NAME">fileUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dataCallBack</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">meGetXslt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">httpStatus</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">        </span><span class="COMM">// var vov_xmlhttp = API.createXmlHttpRequest();</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vov_xmlhttp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">        </span><span class="COMM">// vov_xmlhttp.overrideMimeType('text/xml');</span><span class="WHIT">
<span class='line'>120</span> 
<span class='line'>121</span> </span><span class="WHIT">        </span><span class="NAME">vov_xmlhttp.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">            </span><span class="COMM">// alert("Ready xml "+fileUrl+" state "+vov_xmlhttp.readyState);</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vov_xmlhttp.readyState</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">                    </span><span class="NAME">httpStatus</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vov_xmlhttp.status</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">                    </span><span class="COMM">// This apparently happens when the request was aborted,</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">                    </span><span class="COMM">// so simply return</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">                    </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Problem getting httpStatus"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">httpStatus</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">responseData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vov_xmlhttp.responseXML</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">responseData</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">responseData.documentElement</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">responseData.documentElement.nodeName</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'parsererror'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">                        </span><span class="NAME">dataCallBack</span><span class="PUNC">(</span><span class="NAME">responseData</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">                        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Response from '"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"' is not XML? "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">responseData</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">                        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Response from '"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"' is not XML? "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">responseData</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">                    </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"VOView error getting xslt file "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">". Status: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vov_xmlhttp.status</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>142</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"VOView error getting xslt file "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">". Status: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">vov_xmlhttp.status</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>146</span> 
<span class='line'>147</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">            </span><span class="NAME">vov_xmlhttp.open</span><span class="PUNC">(</span><span class="STRN">"GET"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">            </span><span class="NAME">vov_xmlhttp.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">'Accept'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'text/xml'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">            </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Error opening '"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"':"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">            </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Error opening '"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"':"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e.message</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">        </span><span class="NAME">this.send</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">            </span><span class="NAME">vov_xmlhttp.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">GetXslt</span><span class="PUNC">(</span><span class="NAME">getXsltParams.fileUrl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">getXsltParams.dataCallBack</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>159</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>160</span> 
<span class='line'>161</span> </span><span class="NAME">voview.prototype.selectSingleNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xpath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>164</span> 
<span class='line'>165</span> </span><span class="WHIT">    </span><span class="COMM">// Mozilla version</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">        </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">inDoc.evaluate</span><span class="PUNC">(</span><span class="NAME">xpath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">XPathResult.FIRST_ORDERED_NODE_TYPE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">singleNodeValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">        </span><span class="NAME">e1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>171</span> 
<span class='line'>172</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">        </span><span class="COMM">// IE version</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">        </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">            </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">inDoc.selectSingleNode</span><span class="PUNC">(</span><span class="NAME">xpath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">            </span><span class="NAME">e2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>179</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>180</span> 
<span class='line'>181</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">e2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Unable to execute selectSingleNode. Mozilla: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e1.message</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" IE: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e2.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"Unable to execute selectSingleNode. Mozilla: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e1.message</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" IE: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e2.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>184</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>185</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>186</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>187</span> 
<span class='line'>188</span> </span><span class="NAME">voview.prototype.selectNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">inDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xpath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>190</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>192</span> 
<span class='line'>193</span> </span><span class="WHIT">    </span><span class="COMM">// Mozilla version</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">        </span><span class="NAME">nodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">inDoc.evaluate</span><span class="PUNC">(</span><span class="NAME">xpath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">XPathResult.ANY_TYPE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">        </span><span class="NAME">e1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>199</span> 
<span class='line'>200</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">e1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodes.iterateNext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">        </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">            </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>204</span> </span><span class="WHIT">            </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodes.iterateNext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>208</span> 
<span class='line'>209</span> </span><span class="WHIT">    </span><span class="COMM">// IE version</span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">        </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">inDoc.selectNodes</span><span class="PUNC">(</span><span class="NAME">xpath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">        </span><span class="NAME">e2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>215</span> 
<span class='line'>216</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">e2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Unable to execute selectSingleNode. Mozilla: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e1.message</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" IE: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e2.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"Unable to execute selectSingleNode. Mozilla: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e1.message</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" IE: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e2.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>221</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>222</span> 
<span class='line'>223</span> </span><span class="NAME">voview.prototype.getElementsByClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">searchClass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">classElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">        </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">        </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>231</span> 
<span class='line'>232</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">els</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node.getElementsByTagName</span><span class="PUNC">(</span><span class="NAME">tag</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elsLen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">els.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pattern</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">"(^|\\s)"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">searchClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"(\\s|$)"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">elsLen</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pattern.test</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">className</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">            </span><span class="NAME">classElements</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">els</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>238</span> </span><span class="WHIT">            </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">classElements</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>242</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>243</span> </span><span class="COMM">/**
<span class='line'>244</span>  * Helper function for instantiating a Filter object.
<span class='line'>245</span>  * 
<span class='line'>246</span>  * @param {XML DOM Object} filterParams.votableDOM The VOTABLE to be filtered.
<span class='line'>247</span>  * @param {function} filterParams.filterCallback Function to call when the
<span class='line'>248</span>  *            result of the filtering is completed. The one argument to this
<span class='line'>249</span>  *            function is an XML DOM object of the filtered VOTABLE.
<span class='line'>250</span>  * 
<span class='line'>251</span>  * @returns {Filter} Newly created Filter object.
<span class='line'>252</span>  */</span><span class="WHIT">
<span class='line'>253</span> </span><span class="NAME">voview.prototype.makeFilter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">filterParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>255</span>      * @class Object for doing sorting, filtering and paging of a VOTABLE.
<span class='line'>256</span>      * @see voview#makeFilter
<span class='line'>257</span>      */</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Filter</span><span class="PUNC">(</span><span class="NAME">_votableDOM</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filterCallback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">meFilter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preProcDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preProcessed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterCallback</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">votableDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_votableDOM</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>264</span> 
<span class='line'>265</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filterDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filterProc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XSLTProcessor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>268</span> 
<span class='line'>269</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">constraints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">types</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>271</span> 
<span class='line'>272</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">range</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">stop</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>273</span> 
<span class='line'>274</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sortColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>275</span> 
<span class='line'>276</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectCriteria</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span> 
<span class='line'>278</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filteredTableDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>279</span> 
<span class='line'>280</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">preProcessMod</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xslTopNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preProcDOM.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"stylesheet"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>282</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>283</span> 
<span class='line'>284</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">filterModify</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>286</span> 
<span class='line'>287</span> </span><span class="WHIT">            </span><span class="COMM">// Internal Functions</span><span class="WHIT">
<span class='line'>288</span> 
<span class='line'>289</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">trim</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str.replace</span><span class="PUNC">(</span><span class="REGX">/^\s*(\S*(\s+\S+)*)\s*$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"$1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>292</span> 
<span class='line'>293</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">rangeConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.split</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">negate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">                    </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"TD["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]/@val >"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" or "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"TD["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]/@val >"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">                    </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"TD["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]/@val >="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" and "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"TD["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]/@val &lt;="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>306</span> 
<span class='line'>307</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">numConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numVals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.split</span><span class="PUNC">(</span><span class="REGX">/(\.\.|[&lt;>]=?)/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">numVals.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">                    </span><span class="NAME">numVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">numVals</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">numVal.match</span><span class="PUNC">(</span><span class="REGX">/[eE]/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.replace</span><span class="PUNC">(</span><span class="NAME">numVal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">numVal</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>316</span> 
<span class='line'>317</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.indexOf</span><span class="PUNC">(</span><span class="STRN">".."</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rangeConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">negate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">">="</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>322</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.replace</span><span class="PUNC">(</span><span class="STRN">">="</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"&lt;="</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.replace</span><span class="PUNC">(</span><span class="STRN">"&lt;="</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">">"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">">"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.replace</span><span class="PUNC">(</span><span class="STRN">">"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">">="</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"&lt;"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.replace</span><span class="PUNC">(</span><span class="STRN">"&lt;"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;="</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"!="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"!"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">">"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.replace</span><span class="PUNC">(</span><span class="STRN">">"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">">"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"&lt;"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.replace</span><span class="PUNC">(</span><span class="STRN">"&lt;"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">                        </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"="</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">                </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"TD["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]/@val"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>344</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>346</span> 
<span class='line'>347</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">wildCardConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>348</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.split</span><span class="PUNC">(</span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>349</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">                </span><span class="NAME">out.push</span><span class="PUNC">(</span><span class="STRN">"position() = "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>351</span> 
<span class='line'>352</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"translate(normalize-space(),$lc,$uc)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">                    </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">",'"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"')"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">                    </span><span class="NAME">out.push</span><span class="PUNC">(</span><span class="STRN">"starts-with"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">                    </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"substring-after"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">fields.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">                        </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">",'"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"')"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">                        </span><span class="NAME">out.push</span><span class="PUNC">(</span><span class="STRN">"contains"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">                        </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"substring-after"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">fields.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">                    </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"(concat("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">",'a'),'"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">fields.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"a')"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">                    </span><span class="NAME">out.push</span><span class="PUNC">(</span><span class="STRN">"contains"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>369</span> 
<span class='line'>370</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">out.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>371</span> </span><span class="WHIT">                    </span><span class="COMM">// no constraints (this can happen with a value like "*" or</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">                    </span><span class="COMM">// "**")</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>375</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">negate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>376</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">                    </span><span class="NAME">out.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">                    </span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" and not("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">out.join</span><span class="PUNC">(</span><span class="STRN">" and "</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>379</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">                    </span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">out.join</span><span class="PUNC">(</span><span class="STRN">" and "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"TD["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>384</span> 
<span class='line'>385</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">stdCharConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">                </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">trim</span><span class="PUNC">(</span><span class="NAME">constraint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">negate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"translate(normalize-space("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"TD["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]), $lc, $uc)!='"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"'"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"translate(normalize-space("</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"TD["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]), $lc, $uc)='"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"'"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>392</span> 
<span class='line'>393</span> </span><span class="WHIT">            </span><span class="COMM">// Handle a constraint on a character column</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">charConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">                </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.indexOf</span><span class="PUNC">(</span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">wildCardConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">stdCharConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>401</span> 
<span class='line'>402</span> </span><span class="WHIT">            </span><span class="COMM">// Convert a single constraint into appropriate XSLT filter</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">            </span><span class="COMM">// elements.</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">makeXSLConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isChar</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'!'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">                    </span><span class="NAME">negate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">                    </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">                    </span><span class="NAME">negate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>415</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">'='</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>416</span> </span><span class="WHIT">                    </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>418</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>420</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isChar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">charConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">numConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">negate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>426</span> 
<span class='line'>427</span> </span><span class="WHIT">            </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">makeOneConstraint</span><span class="PUNC">(</span><span class="NAME">prefix</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">suffix</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">all</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">constraints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">column.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">                        </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="PUNC">+</span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">                            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">                            </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columnNames</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">columnNames.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">                                </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>438</span> </span><span class="WHIT">                            </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>440</span> 
<span class='line'>441</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeXSLConstraint</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">constraints</span><span class="PUNC">[</span><span class="NAME">column</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">column</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">                            </span><span class="NAME">all.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">con.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">all.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">                    </span><span class="COMM">// sort to put shortest constraints (presumably fastest)</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">                    </span><span class="COMM">// first</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sortfunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>452</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">                    </span><span class="NAME">all.sort</span><span class="PUNC">(</span><span class="NAME">sortfunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">                    </span><span class="COMM">// get rid of the lengths</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">all.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">                        </span><span class="NAME">all</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">all</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>458</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">full</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">all.join</span><span class="PUNC">(</span><span class="STRN">" and "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>459</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">full</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>460</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>461</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>462</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>463</span> 
<span class='line'>464</span> </span><span class="WHIT">            </span><span class="COMM">// End Internal Functions</span><span class="WHIT">
<span class='line'>465</span> 
<span class='line'>466</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nsprefixes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"vo:"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"v1:"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"v2:"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"v3:"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"v4:"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nssuffixes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"0"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"1"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"2"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"3"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"4"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>468</span> 
<span class='line'>469</span> </span><span class="WHIT">            </span><span class="COMM">// Populate array mapping column names with numbers (ie order)</span><span class="WHIT">
<span class='line'>470</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fieldElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">votableDOM.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"FIELD"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>471</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fieldAttribs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ifield</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ifield</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">fieldElements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ifield</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>473</span> </span><span class="WHIT">                </span><span class="NAME">fieldAttribs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fieldElements</span><span class="PUNC">[</span><span class="NAME">ifield</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">attributes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>474</span> </span><span class="WHIT">                </span><span class="NAME">columnNames.push</span><span class="PUNC">(</span><span class="NAME">fieldAttribs.getNamedItem</span><span class="PUNC">(</span><span class="STRN">"name"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>476</span> 
<span class='line'>477</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xslgen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">            </span><span class="COMM">// build separate constraint variables for each possible namespace</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">            </span><span class="COMM">// prefix</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">            </span><span class="COMM">// this is repetitive, but time is negligible here (and long in</span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">            </span><span class="COMM">// XSLT)</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">nsprefixes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">                </span><span class="NAME">xslgen</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeOneConstraint</span><span class="PUNC">(</span><span class="NAME">nsprefixes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nssuffixes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>485</span> 
<span class='line'>486</span> </span><span class="WHIT">            </span><span class="COMM">// Replace the dummy values in the xslt stylesheet with the</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">            </span><span class="COMM">// generated filter expressions</span><span class="WHIT">
<span class='line'>488</span> 
<span class='line'>489</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xslVarNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterDOM.documentElement.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"xsl:variable"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">xslVarNodes</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">xslVarNodes.length</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">                </span><span class="COMM">// alert("second try");</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">                </span><span class="NAME">xslVarNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterDOM.documentElement.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">"variable"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">            </span><span class="COMM">// alert("xslVarNodes.length: "+xslVarNodes.length);</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">xslVarNodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">varNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xslVarNodes</span><span class="PUNC">[</span><span class="NAME">node</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">varNode.getAttribute</span><span class="PUNC">(</span><span class="STRN">"name"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">matchResults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodeName.match</span><span class="PUNC">(</span><span class="REGX">/filterRows(\d?)/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">matchResults</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nsIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">matchResults</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">matchResults</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">                        </span><span class="NAME">nsIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nsIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nsIndex</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">nsprefixes.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">                        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Filter error editing expressions in xslt."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">                        </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"Filter error editing expressions in xslt."</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">varNode.getAttributeNode</span><span class="PUNC">(</span><span class="STRN">"select"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xslgen</span><span class="PUNC">[</span><span class="NAME">nsIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">                        </span><span class="NAME">selectNode.nodeValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"$allRows"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">matchResults</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">                        </span><span class="NAME">selectNode.nodeValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"$allRows"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">matchResults</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">xslgen</span><span class="PUNC">[</span><span class="NAME">nsIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>516</span> 
<span class='line'>517</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">preprocess</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempDOM</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">preProcessed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">                </span><span class="NAME">preProcessed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">                </span><span class="NAME">preProcessMod</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preProcessor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XSLTProcessor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">                    </span><span class="NAME">preProcessor.importStylesheet</span><span class="PUNC">(</span><span class="NAME">preProcDOM</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">                    </span><span class="NAME">tempDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preProcessor.transformToDocument</span><span class="PUNC">(</span><span class="NAME">votableDOM</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">                    </span><span class="NAME">votableDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tempDOM</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">                    </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Error preprocessing XML doc: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e1.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>532</span> 
<span class='line'>533</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">ready</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempDOM</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmlstring</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">            </span><span class="COMM">// alert("ready called filterDOM = "+filterDOM+", preProcDOM =</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">            </span><span class="COMM">// "+preProcDOM);</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filterDOM</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">preProcDOM</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">                </span><span class="COMM">// Do the actual filtering work and call back with the result.</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">                </span><span class="NAME">preprocess</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>541</span> 
<span class='line'>542</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">filtered</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">                    </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>544</span> 
<span class='line'>545</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>546</span>                      * Debug printout
<span class='line'>547</span>                      * 
<span class='line'>548</span>                      * var xmlstring = (new
<span class='line'>549</span>                      * XMLSerializer()).serializeToString(filterDOM); xmlstring =
<span class='line'>550</span>                      * xmlstring.replace(/&lt;/g,"&lt;"); xmlstring =
<span class='line'>551</span>                      * xmlstring.replace(/>/g,"&gt;\n");
<span class='line'>552</span>                      * document.getElementById("output").innerHTML = xmlstring;
<span class='line'>553</span>                      */</span><span class="WHIT">
<span class='line'>554</span> 
<span class='line'>555</span> </span><span class="WHIT">                    </span><span class="NAME">filterModify</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>556</span> 
<span class='line'>557</span> </span><span class="WHIT">                    </span><span class="COMM">/**
<span class='line'>558</span>                      * Debug printout
<span class='line'>559</span>                      * 
<span class='line'>560</span>                      * xmlstring = (new
<span class='line'>561</span>                      * XMLSerializer()).serializeToString(filterDOM); xmlstring =
<span class='line'>562</span>                      * xmlstring.replace(/&lt;/g, "&lt;"); xmlstring =
<span class='line'>563</span>                      * xmlstring.replace(/>/g, "&gt;\n");
<span class='line'>564</span>                      * document.getElementById("output").innerHTML = xmlstring;
<span class='line'>565</span>                      */</span><span class="WHIT">
<span class='line'>566</span> 
<span class='line'>567</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filterProc.reset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>568</span> </span><span class="WHIT">                        </span><span class="NAME">filterProc.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">                    </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">                        </span><span class="NAME">filterProc.importStylesheet</span><span class="PUNC">(</span><span class="NAME">filterDOM</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>572</span> </span><span class="WHIT">                        </span><span class="NAME">filterProc.clearParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>573</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sortColumns</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sortColumns.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">                            </span><span class="NAME">filterProc.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"sortColumn"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sortColumns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>575</span> </span><span class="WHIT">                            </span><span class="NAME">filterProc.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"sortOrder"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sortColumns</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">direction</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>576</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>577</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">range.stop</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">                            </span><span class="NAME">filterProc.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pageStart"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">range.start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>579</span> </span><span class="WHIT">                            </span><span class="NAME">filterProc.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pageEnd"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">range.stop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>580</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">selectCriteria</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">                            </span><span class="NAME">filterProc.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"selectAllCriteria"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selectCriteria</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">                        </span><span class="NAME">filteredTableDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterProc.transformToDocument</span><span class="PUNC">(</span><span class="NAME">votableDOM</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">                        </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Error processing votable DOM thru Filter: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e2.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>589</span> 
<span class='line'>590</span> </span><span class="WHIT">                </span><span class="NAME">resultCallback</span><span class="PUNC">(</span><span class="NAME">filteredTableDOM</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>593</span> 
<span class='line'>594</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>595</span>          * Produces a single page's worth of VOTABLE data. After filtering is
<span class='line'>596</span>          * complete, the filterCallback function is called with the results.
<span class='line'>597</span>          * 
<span class='line'>598</span>          * @param {function} filterParams.filterCallback Function to call when
<span class='line'>599</span>          *            the result of the filtering is completed. The one argument
<span class='line'>600</span>          *            to this function is an XML DOM object of the filtered
<span class='line'>601</span>          *            VOTABLE. If omitted then use function specified in
<span class='line'>602</span>          *            constructor.
<span class='line'>603</span>          */</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">        </span><span class="NAME">this.doFilter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">filterParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filterDOMCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">                </span><span class="NAME">filterDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">                </span><span class="NAME">ready</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>609</span> 
<span class='line'>610</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preprocDOMCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">                </span><span class="NAME">preProcDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">                </span><span class="NAME">ready</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>614</span> 
<span class='line'>615</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filterParams</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">filterParams.filterCallback</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">                </span><span class="NAME">resultCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterParams.filterCallback</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filterDOM</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">voview.filter_xsl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filterParser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DOMParser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">                    </span><span class="NAME">filterDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterParser.parseFromString</span><span class="PUNC">(</span><span class="NAME">voview.filter_xsl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text/xml"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filterGet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meFilter.makeGetXslt</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"@XSL_PATH@filter.xsl"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">                        </span><span class="NAME">dataCallBack</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">filterDOMCallback</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">                    </span><span class="NAME">filterGet.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">preProcDOM</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">voview.preproc_xsl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preProcParser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DOMParser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">                    </span><span class="NAME">preProcDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">preProcParser.parseFromString</span><span class="PUNC">(</span><span class="NAME">voview.preproc_xsl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text/xml"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preprocGet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meFilter.makeGetXslt</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"@XSL_PATH@preProcess.xsl"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">                        </span><span class="NAME">dataCallBack</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">preprocDOMCallback</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">                    </span><span class="NAME">preprocGet.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">            </span><span class="NAME">ready</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>640</span> 
<span class='line'>641</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>642</span>          * Set column value filters on the VOTABLE. Any filters all ready set on
<span class='line'>643</span>          * columns not specified in the filterKeys are retained.
<span class='line'>644</span>          * 
<span class='line'>645</span>          * @param {setFilterParams.filterKeys[]} filterKeys An array of type
<span class='line'>646</span>          *            columnFilterKey.
<span class='line'>647</span>          */</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">        </span><span class="NAME">this.setColumnFilters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">setFilterParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">setFilterParams.filterKeys.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setFilterParams.filterKeys</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraints</span><span class="PUNC">[</span><span class="NAME">key.column</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">key.expression</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">                    </span><span class="NAME">constraints</span><span class="PUNC">[</span><span class="NAME">key.column</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key.expression</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">                    </span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">key.column</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key.isCharType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">                    </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>658</span> 
<span class='line'>659</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>660</span>          * Clear any column value filters currently set on the VOTABLE.
<span class='line'>661</span>          */</span><span class="WHIT">
<span class='line'>662</span> </span><span class="WHIT">        </span><span class="NAME">this.clearColumnFilters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>663</span> </span><span class="WHIT">            </span><span class="NAME">constraints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">            </span><span class="NAME">types</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">            </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>667</span> 
<span class='line'>668</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>669</span>          * Set range of rows to be extracted from the VOTABLE.
<span class='line'>670</span>          * 
<span class='line'>671</span>          * @param {integer} setRangeParam.firstRow The first row of the range.
<span class='line'>672</span>          * @param {integer} setRangeParam.lastRow The last row of the range.
<span class='line'>673</span>          */</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">        </span><span class="NAME">this.setRowRange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">setRangeParam</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">range.start</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">setRangeParam.firstRow</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">range.stop</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">setRangeParam.lastRow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">                </span><span class="NAME">range.start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setRangeParam.firstRow</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">                </span><span class="NAME">range.stop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setRangeParam.lastRow</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>678</span> </span><span class="WHIT">                </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>679</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>680</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>681</span> 
<span class='line'>682</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>683</span>          * Set the columns to use for sorting the table, and the sorting
<span class='line'>684</span>          * direction for each column.
<span class='line'>685</span>          * 
<span class='line'>686</span>          * @param {setSortParams.sortKeys[]} sortKeys An array of type
<span class='line'>687</span>          *            sortColumnKey. The first key in the array has the highest
<span class='line'>688</span>          *            precedence.
<span class='line'>689</span>          */</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">        </span><span class="NAME">this.setSortColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">setSortParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sortColumns</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numCols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sortColumns.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ikey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ikey</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">setSortParams.sortKeys.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">ikey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ikey</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ikey</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">numCols</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">sortColumns</span><span class="PUNC">[</span><span class="NAME">ikey</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">equals</span><span class="PUNC">(</span><span class="NAME">setSortParams.sortKeys</span><span class="PUNC">[</span><span class="NAME">ikey</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">                        </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">                </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">            </span><span class="NAME">sortColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setSortParams.sortKeys</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>703</span> 
<span class='line'>704</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>705</span>          * Set the criteria which determines which rows will be selected when
<span class='line'>706</span>          * the "select all" button is activated. **ONLY string argument is
<span class='line'>707</span>          * currently implemented**
<span class='line'>708</span>          * 
<span class='line'>709</span>          * @param {string|function} setSelectParams.criteria If a string, use it
<span class='line'>710</span>          *            to match against the contents of the VOTABLE row. The
<span class='line'>711</span>          *            contents of the VOTABLE XML row will be searched and the
<span class='line'>712</span>          *            row will be selected if it contains the input string. If a
<span class='line'>713</span>          *            function, then a function which will be called for each
<span class='line'>714</span>          *            row in the XML VOTABLE, with an XML DOM object of the row
<span class='line'>715</span>          *            as its only argument. The function should return a boolean
<span class='line'>716</span>          *            indicating whether the row should be selected or not.
<span class='line'>717</span>          */</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">        </span><span class="NAME">this.setSelectRows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">setSelectParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">setSelectParams.criteria</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">selectCriteria</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">                </span><span class="NAME">selectCriteria</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setSelectParams.criteria</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">                </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>724</span> 
<span class='line'>725</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>726</span>          * Set the VO table used as input to the filter. One in a table is
<span class='line'>727</span>          * specified, flags are set so that the table will be reprocessed and
<span class='line'>728</span>          * filtered when the doFilter method is called.
<span class='line'>729</span>          * 
<span class='line'>730</span>          * @param {XML DOM Object} setInputParams.tableDOM The XML Dom object
<span class='line'>731</span>          *            for the input VOTABLE.
<span class='line'>732</span>          */</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">        </span><span class="NAME">this.setInputTable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">setInputParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">            </span><span class="NAME">votableDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setInputParams.tableDOM</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">            </span><span class="NAME">preProcessed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">            </span><span class="NAME">filtered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>738</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>740</span>      * Prototype inheritance of voview object methods.
<span class='line'>741</span>      */</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">    </span><span class="NAME">Filter.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Filter</span><span class="PUNC">(</span><span class="NAME">filterParams.votableDOM</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filterParams.filterCallback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>744</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>745</span> </span><span class="COMM">/**
<span class='line'>746</span>  * Helper function for instantiating a Renderer object.
<span class='line'>747</span>  * 
<span class='line'>748</span>  * @param {Filter} rendererParams.filterObject Filter object to be used for
<span class='line'>749</span>  *            generating filter tables from the original VOTABLE.
<span class='line'>750</span>  *            
<span class='line'>751</span>  * @returns {Renderer} Newly created Renderer object.
<span class='line'>752</span>  * 
<span class='line'>753</span>  */</span><span class="WHIT">
<span class='line'>754</span> </span><span class="NAME">voview.prototype.makeRenderer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rendererParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>756</span>      * @class Object used for rendering the HTML display for VOView. Also
<span class='line'>757</span>      *        contains the callback methods that are embedded as javascript in
<span class='line'>758</span>      *        the HTML display.
<span class='line'>759</span>      */</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">    </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">Renderer</span><span class="PUNC">(</span><span class="NAME">_filterObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">meRenderer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filterObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_filterObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderProcessor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XSLTProcessor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">resultCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filteredDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fieldOrder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fieldUCD</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnOrder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filterText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">titleText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>773</span> 
<span class='line'>774</span> </span><span class="WHIT">        </span><span class="NAME">filterObject.setRowRange</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">firstRow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lastRow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>775</span> 
<span class='line'>776</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">renderTable</span><span class="PUNC">(</span><span class="NAME">_filteredDOM</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">            </span><span class="NAME">filteredDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_filteredDOM</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.setTitle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>779</span> 
<span class='line'>780</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.selectNodes</span><span class="PUNC">(</span><span class="NAME">filteredDOM</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"//*[local-name()='FIELD']"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">            </span><span class="NAME">fieldUCD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">            </span><span class="NAME">fieldOrder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">fields.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">                </span><span class="NAME">fieldOrder</span><span class="PUNC">[</span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"name"</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"ucd"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">                    </span><span class="NAME">fieldUCD</span><span class="PUNC">[</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"ucd"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>789</span> 
<span class='line'>790</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columnOrder</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columnOrder</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">columnOrder.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">                    </span><span class="NAME">columnOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fieldOrder</span><span class="PUNC">[</span><span class="NAME">columnOrder</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>795</span> 
<span class='line'>796</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">displayFragment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">renderDOM</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">                </span><span class="COMM">/**
<span class='line'>799</span>                  * Debug printout
<span class='line'>800</span>                  * 
<span class='line'>801</span>                  * var xmlstring = (new
<span class='line'>802</span>                  * XMLSerializer()).serializeToString(filteredDOM); xmlstring =
<span class='line'>803</span>                  * xmlstring.replace(/&lt;\/TR>/gi,"&lt;/TR>
<span class='line'>804</span>                  * \n\t"); xmlstring = xmlstring.replace(/&lt;/g,"&lt;");
<span class='line'>805</span>                  * xmlstring = xmlstring.replace(/>/g,"&gt;");
<span class='line'>806</span>                  * document.getElementById("output").innerHTML = xmlstring;
<span class='line'>807</span>                  * 
<span class='line'>808</span>                  */</span><span class="WHIT">
<span class='line'>809</span> 
<span class='line'>810</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">renderProcessor.reset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">                </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.importStylesheet</span><span class="PUNC">(</span><span class="NAME">renderDOM</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>815</span> 
<span class='line'>816</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"pageCallback"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.newPage"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setPageLength"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.setPageLength"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setMaxColumnsCallback"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.setMaxColumns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"sortCallback"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.sortTable"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>824</span> 
<span class='line'>825</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"filterCallback"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.filterByColumn"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"filterResetCallback"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.filterReset"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>829</span> 
<span class='line'>830</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"clickClearCallback"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.clickClear"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"clickResetCallback"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.clickRecall"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>834</span> 
<span class='line'>835</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"widgetIDprefix"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rendererParams.vovParams.widgetIDprefix</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"filterText"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">filterText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>837</span> 
<span class='line'>838</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"titleText"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">titleText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>839</span> 
<span class='line'>840</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxColumns</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">                        </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"maxColumns"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxColumns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columnOrder</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">                        </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"columnOrder"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">columnOrder.join</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">                    </span><span class="NAME">renderProcessor.setParameter</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"resetColumnOrderCallback"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">                            </span><span class="NAME">rendererParams.vovParams.objectName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".renderObject.resetColumnOrder"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>848</span> 
<span class='line'>849</span> </span><span class="WHIT">                    </span><span class="NAME">displayFragment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">renderProcessor.transformToDocument</span><span class="PUNC">(</span><span class="NAME">filteredDOM</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">                    </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"Error rendering XML doc: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e1.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>852</span> </span><span class="WHIT">                    </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"Error rendering XML doc: "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e1.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">            </span><span class="NAME">resultCallback</span><span class="PUNC">(</span><span class="NAME">displayFragment</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>857</span> 
<span class='line'>858</span> </span><span class="WHIT">        </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="NAME">setColumnOrder</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">            </span><span class="COMM">// determine the column order from the table</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">table.tBodies</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">rows</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxcolumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rows.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">order</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">rows.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">classname</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rows</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">classname.indexOf</span><span class="PUNC">(</span><span class="STRN">"separator"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">                    </span><span class="NAME">maxcolumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">                    </span><span class="COMM">// ID for row is 'fieldrow_&lt;number>'</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rows</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id.split</span><span class="PUNC">(</span><span class="STRN">'_'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">                    </span><span class="NAME">order.push</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NAME">f.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.setDisplayedColumns</span><span class="PUNC">(</span><span class="NAME">order</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.setDisplayedColumns</span><span class="PUNC">(</span><span class="NAME">maxcolumns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>877</span> 
<span class='line'>878</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>879</span>          * Callback function which takes the XML document containing the
<span class='line'>880</span>          * rendered HTML for the display, and places it in the web page.
<span class='line'>881</span>          * Different parts of the display can be placed at different locations
<span class='line'>882</span>          * in the web page based on the IDs of various divs specified in the web
<span class='line'>883</span>          * page.
<span class='line'>884</span>          * 
<span class='line'>885</span>          * @param {XML Dom object} xmlDoc XML document containing the rendered
<span class='line'>886</span>          *            HTML.
<span class='line'>887</span>          */</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">        </span><span class="NAME">this.displayHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xmlDoc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">docElements</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">widgetName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fragElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>892</span> 
<span class='line'>893</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.selectSingleNode</span><span class="PUNC">(</span><span class="NAME">xmlDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"//form[@name='widgets']/input[@name='widget_names']"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">subwidgets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getAttribute</span><span class="PUNC">(</span><span class="STRN">"value"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">subwidgets.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">                </span><span class="COMM">// First time thru, need to delete the "all" widget, because it</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">                </span><span class="COMM">// contains the other widgets</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">allElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">                    </span><span class="NAME">allElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">rendererParams.vovParams.widgetIDprefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">".all"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">allElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>902</span> </span><span class="WHIT">                        </span><span class="NAME">allElement.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>905</span> 
<span class='line'>906</span> </span><span class="WHIT">                </span><span class="NAME">widgetName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rendererParams.vovParams.widgetIDprefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">subwidgets</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">                </span><span class="NAME">docElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.getElementsByClass</span><span class="PUNC">(</span><span class="NAME">widgetName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">docElements.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">                    </span><span class="NAME">fragElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.selectSingleNode</span><span class="PUNC">(</span><span class="NAME">xmlDoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"//*[@id=\""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">widgetName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\"]"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">                            </span><span class="PUNC">.</span><span class="NAME">cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">                    </span><span class="NAME">fragElement.removeAttribute</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">docElements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">                        </span><span class="NAME">docElements</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLSerializer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">serializeToString</span><span class="PUNC">(</span><span class="NAME">fragElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>917</span> 
<span class='line'>918</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ftable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">'voview_column_fields'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ftable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tablednd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">TableDnD.TableDnD</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">                </span><span class="NAME">tablednd.onDrop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">setColumnOrder</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">                </span><span class="NAME">tablednd.init</span><span class="PUNC">(</span><span class="NAME">ftable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>925</span> 
<span class='line'>926</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>927</span>          * Webpage callback function which instructs VOView to display a new
<span class='line'>928</span>          * page of the VOTABLE.
<span class='line'>929</span>          * 
<span class='line'>930</span>          * @param {integer} pageNumber The page of the table to display.
<span class='line'>931</span>          */</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">        </span><span class="NAME">this.newPage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pageNumber</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.selectSingleNode</span><span class="PUNC">(</span><span class="NAME">filteredDOM</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"//*[@ID='VOV:PageStart']"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pageStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">startElement.getAttribute</span><span class="PUNC">(</span><span class="STRN">"value"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.selectSingleNode</span><span class="PUNC">(</span><span class="NAME">filteredDOM</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"//*[@ID='VOV:PageEnd']"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pageEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">endElement.getAttribute</span><span class="PUNC">(</span><span class="STRN">"value"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>937</span> 
<span class='line'>938</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pageEnd</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">pageStart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pageNumber</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pageEnd</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">pageStart</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pageNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">            </span><span class="NAME">filterObject.setRowRange</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">firstRow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">newStart</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lastRow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">newEnd</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>941</span> 
<span class='line'>942</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>944</span> 
<span class='line'>945</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>946</span>          * Set the maximum number of columns shown in the VOView display. The
<span class='line'>947</span>          * display is then rendered with the new setting.
<span class='line'>948</span>          * 
<span class='line'>949</span>          * @param {integer} columns Maximum number of columns shown in the
<span class='line'>950</span>          *            display.
<span class='line'>951</span>          */</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">        </span><span class="NAME">this.setMaxColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_maxColumns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">            </span><span class="NAME">maxColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_maxColumns</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>956</span> 
<span class='line'>957</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>958</span>          * Set the order and number of columns to display.
<span class='line'>959</span>          * 
<span class='line'>960</span>          * @param {integer[]|string[]|integer} columnInfo If an array, contains
<span class='line'>961</span>          *            a list of columns in the order in which they are to
<span class='line'>962</span>          *            appear. If an integer array, the numbers correspond to the
<span class='line'>963</span>          *            original order of the columns in the VOTABLE. If a string
<span class='line'>964</span>          *            array, the strings must correspond to column names. If a
<span class='line'>965</span>          *            scalar integer, then this value sets the maximum number of
<span class='line'>966</span>          *            columns to initially display in the HTML table.
<span class='line'>967</span>          */</span><span class="WHIT">
<span class='line'>968</span> </span><span class="WHIT">        </span><span class="NAME">this.setDisplayedColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">columnInfo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columnInfo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>970</span> </span><span class="WHIT">                </span><span class="NAME">maxColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnInfo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columnInfo.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">                </span><span class="NAME">columnOrder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnInfo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">                </span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"columnInfo must be an integer or array"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">                </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"columnInfo must be an integer or array"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>978</span> 
<span class='line'>979</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>980</span>          * Reset the column order and maximum number of columns displayed to
<span class='line'>981</span>          * their default settings, and then render the table.
<span class='line'>982</span>          */</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">        </span><span class="NAME">this.resetColumnOrder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">            </span><span class="NAME">columnOrder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">            </span><span class="NAME">maxColumns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>988</span> 
<span class='line'>989</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>990</span>          * Set the number of rows shown in a single page in the VOView display,
<span class='line'>991</span>          * and then render the table with the new settings.
<span class='line'>992</span>          * 
<span class='line'>993</span>          * @param {integer} pageLength The number of rows in a single page in
<span class='line'>994</span>          *            the VOView display.
<span class='line'>995</span>          */</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">        </span><span class="NAME">this.setPageLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pageLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.selectSingleNode</span><span class="PUNC">(</span><span class="NAME">filteredDOM</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"//*[@ID='VOV:PageStart']"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pageStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">startElement.getAttribute</span><span class="PUNC">(</span><span class="STRN">"value"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">pageLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1000</span> 
<span class='line'>1001</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentPage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">pageStart</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">pageLength</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1002</span> 
<span class='line'>1003</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newStart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentPage</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">currentPage</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">            </span><span class="NAME">filterObject.setRowRange</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">firstRow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">newStart</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lastRow</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">newEnd</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1006</span> 
<span class='line'>1007</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1009</span> 
<span class='line'>1010</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1011</span>          * Set the column to use for sorting the VOTABLE, based on information
<span class='line'>1012</span>          * in the supplied column header element. If this column is already the
<span class='line'>1013</span>          * column being used for sorting, then toggle the sorting direction. The
<span class='line'>1014</span>          * table is then re-rendered.
<span class='line'>1015</span>          * 
<span class='line'>1016</span>          * @param {HTML DOM element} headElement HTML Dom element of the header
<span class='line'>1017</span>          *            cell of the column to be used for sorting.
<span class='line'>1018</span>          */</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">        </span><span class="NAME">this.sortTable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">headElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">headElement.className.indexOf</span><span class="PUNC">(</span><span class="STRN">"ascending"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">                </span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"descending"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">                </span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"ascending"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1027</span> 
<span class='line'>1028</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.makeSortColumnKey</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">headElement.innerHTML</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">            </span><span class="NAME">keys.push</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1030</span> 
<span class='line'>1031</span> </span><span class="WHIT">            </span><span class="NAME">filterObject.setSortColumns</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">sortKeys</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1034</span> 
<span class='line'>1035</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1036</span>          * 
<span class='line'>1037</span>          */</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">        </span><span class="NAME">this.filterByColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">decimal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">components</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1043</span> 
<span class='line'>1044</span> </span><span class="WHIT">            </span><span class="NAME">filterText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1045</span> 
<span class='line'>1046</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">form.elements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">                </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">form.elements</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.tagName</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"INPUT"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"text"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">el.className.match</span><span class="PUNC">(</span><span class="STRN">"defaultComment"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">constraint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">                        </span><span class="COMM">// field number is in trailing digits</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">el.name.replace</span><span class="PUNC">(</span><span class="REGX">/.*[^0-9]/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1053</span> 
<span class='line'>1054</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">isCharType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">form.elements</span><span class="PUNC">[</span><span class="NAME">el.name</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_type"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">                        </span><span class="NAME">isCharType.replace</span><span class="PUNC">(</span><span class="REGX">/^\s*(\S*(\s+\S+)*)\s*$/</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"$1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isCharType.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"false"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">                            </span><span class="NAME">isCharType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">                            </span><span class="NAME">isCharType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1061</span> 
<span class='line'>1062</span> </span><span class="WHIT">                        </span><span class="NAME">filterText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"|"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">":"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1063</span> 
<span class='line'>1064</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isCharType</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">fieldUCD</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">fieldUCD</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/pos.*eq.*main/i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sexigesimal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.match</span><span class="PUNC">(</span><span class="REGX">/[\d\.]+:[\d\.]+:[\d\.]+/</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sexigesimal</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="WHIT">                                </span><span class="NAME">components</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sexigesimal</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">                                </span><span class="NAME">decimal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">components</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">3600</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">                                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fieldUCD</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">match</span><span class="PUNC">(</span><span class="REGX">/ra[\._]/i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">                                    </span><span class="NAME">decimal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">decimal</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">360</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">                                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">                                </span><span class="NAME">constraint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">constraint.replace</span><span class="PUNC">(</span><span class="NAME">sexigesimal</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">decimal</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1075</span> 
<span class='line'>1076</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.makeColumnFilterKey</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">expression</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">constraint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">                            </span><span class="NAME">isCharType</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">isCharType</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">                        </span><span class="NAME">keys.push</span><span class="PUNC">(</span><span class="NAME">key</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1082</span> 
<span class='line'>1083</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filterText</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">                </span><span class="NAME">filterText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterText</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"|"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1086</span> 
<span class='line'>1087</span> </span><span class="WHIT">            </span><span class="NAME">filterObject.clearColumnFilters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">            </span><span class="NAME">filterObject.setColumnFilters</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">filterKeys</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">keys</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1091</span> 
<span class='line'>1092</span> </span><span class="WHIT">        </span><span class="NAME">this.filterReset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">            </span><span class="NAME">filterObject.clearColumnFilters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">            </span><span class="NAME">filterText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">            </span><span class="NAME">meRenderer.render</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1097</span> 
<span class='line'>1098</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1099</span>          * Initiate sequence of events for rendering a table.
<span class='line'>1100</span>          */</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">        </span><span class="NAME">this.render</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">renderParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">renderParams</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">renderParams.renderCallback</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">                </span><span class="NAME">resultCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">renderParams.renderCallback</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1105</span> 
<span class='line'>1106</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">renderDOM</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">voview.renderer_xsl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderParser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DOMParser</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">                    </span><span class="NAME">renderDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">renderParser.parseFromString</span><span class="PUNC">(</span><span class="NAME">voview.renderer_xsl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text/xml"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="WHIT">                    </span><span class="NAME">filterObject.doFilter</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">filterCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">renderTable</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderDOMCallback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">                        </span><span class="NAME">renderDOM</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1114</span> </span><span class="WHIT">                        </span><span class="NAME">filterObject.doFilter</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">filterCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">renderTable</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1116</span> 
<span class='line'>1117</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderGet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.makeGetXslt</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fileUrl</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"@XSL_PATH@renderer.xsl"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">                        </span><span class="NAME">dataCallBack</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">renderDOMCallback</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">                    </span><span class="NAME">renderGet.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">                </span><span class="NAME">filterObject.doFilter</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">filterCallback</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">renderTable</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1124</span> 
<span class='line'>1125</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1126</span> 
<span class='line'>1127</span> </span><span class="WHIT">        </span><span class="NAME">this.clickClear</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">thisfield</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaulttext</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisfield.value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">defaulttext</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">                </span><span class="NAME">thisfield.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisfield.className</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">                </span><span class="NAME">thisfield.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">className.replace</span><span class="PUNC">(</span><span class="REGX">/ *defaultComment */g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1134</span> 
<span class='line'>1135</span> </span><span class="WHIT">        </span><span class="NAME">this.clickRecall</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">thisfield</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaulttext</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">thisfield.value</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">                </span><span class="NAME">thisfield.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">defaulttext</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">                </span><span class="NAME">thisfield.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">thisfield.className</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" defaultComment"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1141</span> 
<span class='line'>1142</span> </span><span class="WHIT">        </span><span class="NAME">this.setTitle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">title</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">title</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">                </span><span class="NAME">titleText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">title</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1147</span> 
<span class='line'>1148</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filteredDOM</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.selectNodes</span><span class="PUNC">(</span><span class="NAME">filteredDOM</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"//*[local-name()='TABLE']/DESCRIPTION/text()"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nodes.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">                    </span><span class="NAME">titleText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nodes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1153</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1155</span> 
<span class='line'>1156</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">meRenderer.votableUrl</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">                </span><span class="NAME">titleText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">meRenderer.votableUrl.match</span><span class="PUNC">(</span><span class="REGX">/[^\/]*$/</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1160</span> 
<span class='line'>1161</span> </span><span class="WHIT">            </span><span class="NAME">titleText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1163</span> 
<span class='line'>1164</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>1166</span>      * Prototype inheritance of voview object methods.
<span class='line'>1167</span>      */</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">    </span><span class="NAME">Renderer.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Renderer</span><span class="PUNC">(</span><span class="NAME">rendererParams.filterObject</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="NAME">voview.filter_xsl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:vo=\"http://www.ivoa.net/xml/VOTable/v1.1\" xmlns:v1=\"http://vizier.u-strasbg.fr/VOTable\" xmlns:v2=\"http://vizier.u-strasbg.fr/xml/VOTable-1.1.xsd\" xmlns:v3=\"http://www.ivoa.net/xml/VOTable/v1.0\" xmlns:v4=\"http://www.ivoa.net/xml/VOTable/v1.2\" exclude-result-prefixes=\"vo v1 v2 v3 v4\" version=\"1.0\">  	&lt;xsl:variable name=\"allRows\" select=\"/VOTABLE/RESOURCE/TABLE/DATA/TABLEDATA/TR\"/>	&lt;xsl:variable name=\"allRows0\" select=\"/vo:VOTABLE/vo:RESOURCE/vo:TABLE/vo:DATA/vo:TABLEDATA/vo:TR\"/>	&lt;xsl:variable name=\"allRows1\" select=\"/v1:VOTABLE/v1:RESOURCE/v1:TABLE/v1:DATA/v1:TABLEDATA/v1:TR\"/>	&lt;xsl:variable name=\"allRows2\" select=\"/v2:VOTABLE/v2:RESOURCE/v2:TABLE/v2:DATA/v2:TABLEDATA/v2:TR\"/>	&lt;xsl:variable name=\"allRows3\" select=\"/v3:VOTABLE/v3:RESOURCE/v3:TABLE/v3:DATA/v3:TABLEDATA/v3:TR\"/>	&lt;xsl:variable name=\"allRows4\" select=\"/v4:VOTABLE/v4:RESOURCE/v4:TABLE/v4:DATA/v4:TABLEDATA/v4:TR\"/>	&lt;xsl:variable name=\"filterRows\" select=\"$allRows[__filterExp__]\"/>	&lt;xsl:variable name=\"filterRows0\" select=\"$allRows0[__filterExp__]\"/>	&lt;xsl:variable name=\"filterRows1\" select=\"$allRows1[__filterExp__]\"/>	&lt;xsl:variable name=\"filterRows2\" select=\"$allRows2[__filterExp__]\"/>	&lt;xsl:variable name=\"filterRows3\" select=\"$allRows3[__filterExp__]\"/>	&lt;xsl:variable name=\"filterRows4\" select=\"$allRows4[__filterExp__]\"/>	&lt;!--	&lt;xsl:variable name=\"filterRows\" select=\"$allRows\"/>	&lt;xsl:variable name=\"filterRows0\" select=\"$allRows0\"/>	&lt;xsl:variable name=\"filterRows1\" select=\"$allRows1\"/>	&lt;xsl:variable name=\"filterRows2\" select=\"$allRows2\"/>	&lt;xsl:variable name=\"filterRows3\" select=\"$allRows3\"/>	&lt;xsl:variable name=\"filterRows4\" select=\"$allRows4\"/>	&lt;xsl:variable name=\"filterRows\" select=\"$allRows[TD[7]/@val&gt;0]\"/>	&lt;xsl:variable name=\"filterRows0\" select=\"$allRows0[vo:TD[7]/@val&gt;0]\"/>	&lt;xsl:variable name=\"filterRows1\" select=\"$allRows1[v1:TD[7]/@val&gt;0]\"/>	&lt;xsl:variable name=\"filterRows2\" select=\"$allRows2[v2:TD[7]/@val&gt;0]\"/>	&lt;xsl:variable name=\"filterRows3\" select=\"$allRows3[v3:TD[7]/@val&gt;0]\"/>	&lt;xsl:variable name=\"filterRows4\" select=\"$allRows4[v4:TD[7]/@val&gt;0]\"/>	--> 	   	&lt;xsl:variable name=\"nrows\" select=\"count($allRows)+count($allRows0)+count($allRows1)+count($allRows2)+count($allRows3)+count($allRows4)\"/>         &lt;xsl:param name=\"sortOrder\">ascending&lt;/xsl:param>    &lt;xsl:param name=\"sortColumn\">1&lt;/xsl:param>    &lt;xsl:param name=\"pageStart\">1&lt;/xsl:param>	&lt;xsl:param name=\"pageEnd\" select=\"$nrows\"/>    &lt;xsl:param name=\"selectAllCriteria\">TR&lt;/xsl:param>        &lt;xsl:variable name=\"fieldlist\" select=\"/VOTABLE/RESOURCE/TABLE/FIELD|/vo:VOTABLE/vo:RESOURCE/vo:TABLE/vo:FIELD|/v1:VOTABLE/v1:RESOURCE/v1:TABLE/v1:FIELD|/v2:VOTABLE/v2:RESOURCE/v2:TABLE/v2:FIELD|/v3:VOTABLE/v3:RESOURCE/v3:TABLE/v3:FIELD|/v4:VOTABLE/v4:RESOURCE/v4:TABLE/v4:FIELD\"/>    &lt;xsl:variable name=\"paramlist\" select=\"/VOTABLE/RESOURCE/PARAM|/vo:VOTABLE/vo:RESOURCE/vo:PARAM|/v1:VOTABLE/v1:RESOURCE/v1:PARAM|/v2:VOTABLE/v2:RESOURCE/v2:PARAM|/v3:VOTABLE/v3:RESOURCE/v3:PARAM|/v4:VOTABLE/v4:RESOURCE/v4:PARAM\"/>        &lt;xsl:variable name=\"lc\" select=\"'abcdefghijklmnopqrstuvwxyz'\"/>    &lt;xsl:variable name=\"uc\" select=\"'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\"/>        &lt;xsl:variable name=\"sortColumnNum\">        &lt;xsl:if test=\"$sortColumn != ''\">        	&lt;xsl:choose>        	&lt;xsl:when test=\"string(number($sortColumn))='NaN'\">            	&lt;xsl:call-template name=\"getColumnByName\">                	&lt;xsl:with-param name=\"value\" select=\"$sortColumn\"/>            	&lt;/xsl:call-template>            &lt;/xsl:when>            &lt;xsl:otherwise>				&lt;xsl:value-of select=\"number($sortColumn)\"/>            &lt;/xsl:otherwise>            &lt;/xsl:choose>        &lt;/xsl:if>    &lt;/xsl:variable>        &lt;xsl:variable name=\"datatype\">        &lt;xsl:choose>            &lt;xsl:when test=\"$sortColumnNum=''\">text&lt;/xsl:when>            &lt;xsl:otherwise>                &lt;xsl:for-each select=\"$fieldlist[position()=$sortColumnNum]\">                    &lt;xsl:choose>                        &lt;xsl:when test=\"not(@arraysize) and (@datatype='float' or @datatype='double' or @datatype='int' or @datatype='long' or @datatype='short' or @datatype='unsignedByte' or @datatype='bit')\">number&lt;/xsl:when>                        &lt;xsl:otherwise>text&lt;/xsl:otherwise>                    &lt;/xsl:choose>                &lt;/xsl:for-each>            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:variable>        &lt;xsl:template name=\"getColumnByName\">        &lt;xsl:param name=\"value\"/>        &lt;xsl:variable name=\"tvalue\" select=\"translate($value,$lc,$uc)\"/>        &lt;xsl:for-each select=\"$fieldlist\">            &lt;xsl:variable name=\"ID\">                &lt;xsl:call-template name=\"getID\"/>            &lt;/xsl:variable>            &lt;xsl:if test=\"translate($ID,$lc,$uc) = $tvalue\">                &lt;xsl:value-of select=\"position()\"/>            &lt;/xsl:if>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;!-- ID is primary FIELD identifier (fall back to name if ID is not available) -->        &lt;xsl:template name=\"getID\">        &lt;xsl:choose>            &lt;xsl:when test=\"@ID\">                &lt;xsl:value-of select=\"@ID\"/>            &lt;/xsl:when>            &lt;xsl:otherwise>                &lt;xsl:value-of select=\"@name\"/>            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;xsl:template name=\"selectAllList\">        &lt;xsl:for-each select=\"/VOTABLE/RESOURCE/TABLE/DATA/TABLEDATA/TR|/vo:VOTABLE/vo:RESOURCE/vo:TABLE/vo:DATA/vo:TABLEDATA/vo:TR|/v1:VOTABLE/v1:RESOURCE/v1:TABLE/v1:DATA/v1:TABLEDATA/v1:TR|/v2:VOTABLE/v2:RESOURCE/v2:TABLE/v2:DATA/v2:TABLEDATA/v2:TR|/v3:VOTABLE/v3:RESOURCE/v3:TABLE/v3:DATA/v3:TABLEDATA/v3:TR|/v4:VOTABLE/v4:RESOURCE/v4:TABLE/v4:DATA/v4:TABLEDATA/v4:T\">&lt;!--        	&lt;xsl:message>Value of default node is &lt;xsl:value-of select=\".\"/>&lt;/xsl:message>-->        	&lt;xsl:if test=\"contains(., $selectAllCriteria) and @vovid\">            	&lt;xsl:value-of select=\"@vovid\"/>,&lt;/xsl:if>        &lt;/xsl:for-each>    &lt;/xsl:template>    &lt;xsl:template match=\"TABLE|vo:TABLE|v1:TABLE|v2:TABLE|v3:TABLE|v4:TABLE\">    	&lt;xsl:variable name=\"inputSpace\">    		&lt;xsl:value-of select=\"namespace-uri()\"/>    	&lt;/xsl:variable>        &lt;xsl:element name=\"PARAM\" namespace=\"{$inputSpace}\">        	&lt;xsl:attribute name=\"datatype\">int&lt;/xsl:attribute>        	&lt;xsl:attribute name=\"ID\">VOV:TotalCount&lt;/xsl:attribute>			&lt;xsl:attribute name=\"value\">				&lt;xsl:value-of select=\"$nrows\"/>        	&lt;/xsl:attribute>	    &lt;/xsl:element>        &lt;xsl:element name=\"PARAM\" namespace=\"{$inputSpace}\">        	&lt;xsl:attribute name=\"datatype\">int&lt;/xsl:attribute>        	&lt;xsl:attribute name=\"ID\">VOV:FilterCount&lt;/xsl:attribute>			&lt;xsl:attribute name=\"value\">				&lt;xsl:value-of select=\"count($filterRows)+count($filterRows0)+count($filterRows1)+count($filterRows2)+count($filterRows3)+count($filterRows4)\"/>        	&lt;/xsl:attribute>	    &lt;/xsl:element>        &lt;xsl:element name=\"PARAM\" namespace=\"{$inputSpace}\">        	&lt;xsl:attribute name=\"datatype\">int&lt;/xsl:attribute>        	&lt;xsl:attribute name=\"ID\">VOV:SelectAllRows&lt;/xsl:attribute>			&lt;xsl:attribute name=\"value\">				&lt;xsl:call-template name=\"selectAllList\"/>			&lt;/xsl:attribute>				    &lt;/xsl:element>        &lt;xsl:element name=\"PARAM\" namespace=\"{$inputSpace}\">        	&lt;xsl:attribute name=\"datatype\">int&lt;/xsl:attribute>        	&lt;xsl:attribute name=\"ID\">VOV:PageStart&lt;/xsl:attribute>			&lt;xsl:attribute name=\"value\">				&lt;xsl:value-of select=\"$pageStart\"/>        	&lt;/xsl:attribute>	    &lt;/xsl:element>        &lt;xsl:element name=\"PARAM\" namespace=\"{$inputSpace}\">        	&lt;xsl:attribute name=\"datatype\">int&lt;/xsl:attribute>        	&lt;xsl:attribute name=\"ID\">VOV:PageEnd&lt;/xsl:attribute>			&lt;xsl:attribute name=\"value\">				&lt;xsl:value-of select=\"$pageEnd\"/>        	&lt;/xsl:attribute>	    &lt;/xsl:element>        &lt;xsl:element name=\"PARAM\" namespace=\"{$inputSpace}\">        	&lt;xsl:attribute name=\"datatype\">int&lt;/xsl:attribute>        	&lt;xsl:attribute name=\"ID\">VOV:SortColumnsList&lt;/xsl:attribute>			&lt;xsl:attribute name=\"value\">				&lt;xsl:choose>					&lt;xsl:when test=\"$sortOrder = 'ascending'\">+&lt;/xsl:when>					&lt;xsl:when test=\"$sortOrder = 'descending'\">-&lt;/xsl:when>				&lt;/xsl:choose>				&lt;xsl:value-of select=\"$sortColumn\"/>			&lt;/xsl:attribute>	    &lt;/xsl:element>        &lt;xsl:copy>            &lt;xsl:apply-templates/>        &lt;/xsl:copy>    &lt;/xsl:template>        &lt;xsl:template match=\"TABLEDATA|vo:TABLEDATA|v1:TABLEDATA|v2:TABLEDATA|v3:TABLEDATA|v4:TABLEDATA\">        &lt;xsl:copy>            	&lt;xsl:for-each select=\"$filterRows|$filterRows0|$filterRows1|$filterRows2|$filterRows3|$filterRows4\">                	&lt;xsl:sort select=\"TD[position()=$sortColumnNum]/@val\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>	                &lt;xsl:sort select=\"TD[position()=$sortColumnNum]\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>    	            &lt;xsl:sort select=\"vo:TD[position()=$sortColumnNum]/@val\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>        	        &lt;xsl:sort select=\"vo:TD[position()=$sortColumnNum]\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>            	    &lt;xsl:sort select=\"v1:TD[position()=$sortColumnNum]/@val\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>                	&lt;xsl:sort select=\"v1:TD[position()=$sortColumnNum]\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>	                &lt;xsl:sort select=\"v2:TD[position()=$sortColumnNum]/@val\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>    	            &lt;xsl:sort select=\"v2:TD[position()=$sortColumnNum]\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>        	        &lt;xsl:sort select=\"v3:TD[position()=$sortColumnNum]/@val\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>            	    &lt;xsl:sort select=\"v3:TD[position()=$sortColumnNum]\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>                	&lt;xsl:sort select=\"v4:TD[position()=$sortColumnNum]/@val\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>	                &lt;xsl:sort select=\"v4:TD[position()=$sortColumnNum]\" order=\"{$sortOrder}\" data-type=\"{$datatype}\"/>    	            &lt;xsl:if test=\"not (position() &lt; $pageStart or position() &gt; $pageEnd)\">        	            &lt;xsl:copy>            	            &lt;xsl:apply-templates select=\"@*|node()\"/>                	    &lt;/xsl:copy>	                &lt;/xsl:if>	            &lt;/xsl:for-each>        &lt;/xsl:copy>    &lt;/xsl:template>        &lt;xsl:template match=\"@*|node()\">        &lt;xsl:copy>            &lt;xsl:apply-templates select=\"@*|node()\"/>        &lt;/xsl:copy>    &lt;/xsl:template>        &lt;xsl:template name=\"start\" match=\"/\">        &lt;xsl:copy>            &lt;xsl:apply-templates/>        &lt;/xsl:copy>    &lt;/xsl:template>&lt;/xsl:stylesheet>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="NAME">voview.preproc_xsl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;xsl:stylesheet version=\"1.0\"	xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:vo=\"http://www.ivoa.net/xml/VOTable/v1.1\"	xmlns:v1=\"http://vizier.u-strasbg.fr/VOTable\" xmlns:v2=\"http://vizier.u-strasbg.fr/xml/VOTable-1.1.xsd\"	xmlns:v3=\"http://www.ivoa.net/xml/VOTable/v1.0\" xmlns:v4=\"http://www.ivoa.net/xml/VOTable/v1.2\"	exclude-result-prefixes=\"vo v1 v2 v3 v4\">	&lt;xsl:output method=\"xml\" />    &lt;xsl:variable name=\"fieldlist\" select=\"/VOTABLE/RESOURCE/TABLE/FIELD|/vo:VOTABLE/vo:RESOURCE/vo:TABLE/vo:FIELD|/v1:VOTABLE/v1:RESOURCE/v1:TABLE/v1:FIELD|/v2:VOTABLE/v2:RESOURCE/v2:TABLE/v2:FIELD|/v3:VOTABLE/v3:RESOURCE/v3:TABLE/v3:FIELD|/v4:VOTABLE/v4:RESOURCE/v4:TABLE/v4:FIELD\"/>	&lt;xsl:variable name=\"ncolumns\" select=\"count($fieldlist)\"/>	&lt;xsl:variable name=\"isNumberList\">		&lt;xsl:call-template name=\"getNumberList\"/>	&lt;/xsl:variable>		&lt;xsl:template name=\"getNumberList\">		&lt;xsl:param name=\"colCounter\" select=\"1\"/>		&lt;xsl:if test=\"contains('|float|double|',concat('|',$fieldlist[position()=$colCounter]/@datatype,'|'))\">			|&lt;xsl:value-of select=\"$colCounter\"/>|		&lt;/xsl:if>		&lt;xsl:if test=\"$colCounter &lt; $ncolumns\">            &lt;xsl:call-template name=\"getNumberList\">                &lt;xsl:with-param name=\"colCounter\" select=\"$colCounter+1\"/>            &lt;/xsl:call-template>				&lt;/xsl:if>	&lt;/xsl:template>			&lt;xsl:template		match=\"TABLEDATA|vo:TABLEDATA|v1:TABLEDATA|v2:TABLEDATA|v3:TABLEDATA|v4:TABLEDATA\">		&lt;xsl:copy>&lt;!-- copy the TABLEDATA element -->			&lt;xsl:for-each select=\"TR|vo:TR|v1:TR|v2:TR|v3:TR|v4:TR\">				&lt;xsl:variable name=\"vovid\" select=\"position()\" />				&lt;xsl:copy>&lt;!-- copy the TR element -->					&lt;xsl:attribute name=\"vovid\">						&lt;xsl:value-of select=\"$vovid\" /> 					&lt;/xsl:attribute>					&lt;xsl:for-each select=\"TD|vo:TD|v1:TD|v2:TD|v3:TD|v4:TD\">						&lt;xsl:variable name=\"posit\" select=\"position()\" />						&lt;xsl:choose>							&lt;xsl:when								test=\"contains($isNumberList,concat('|',$posit,'|'))\">								&lt;xsl:copy>									&lt;xsl:attribute name=\"val\">                           				&lt;xsl:call-template name=\"SciNum\">                              				&lt;xsl:with-param name=\"num\" select=\".\" />                           				&lt;/xsl:call-template>                        			&lt;/xsl:attribute>									&lt;!-- apparently must do attribute first -->									&lt;xsl:value-of select=\".\" />								&lt;/xsl:copy>							&lt;/xsl:when>							&lt;xsl:otherwise>								&lt;xsl:copy>&lt;!-- copy just the TD element -->									&lt;xsl:value-of select=\".\" />								&lt;/xsl:copy>							&lt;/xsl:otherwise>						&lt;/xsl:choose>					&lt;/xsl:for-each>				&lt;/xsl:copy>				&lt;xsl:value-of select=\"string('&#xA;')\" />			&lt;/xsl:for-each>		&lt;/xsl:copy>	&lt;/xsl:template>	&lt;xsl:strip-space		elements=\"TABLEDATA vo:TABLEDATA v1:TABLEDATA v2:TABLEDATA v3:TABLEDATA v4:TABLEDATA\" />	&lt;!-- standard copy template -->	&lt;xsl:template match=\"@*|node()\">		&lt;xsl:copy>			&lt;xsl:apply-templates select=\"@*\" />			&lt;xsl:apply-templates />		&lt;/xsl:copy>	&lt;/xsl:template>	&lt;xsl:template name=\"SciNum\">		&lt;xsl:param name=\"num\" />		&lt;!-- Get rid of +.  They cause problems is xslt1.0. -->		&lt;xsl:variable name=\"input\" select=\"translate($num, 'E+', 'e')\" />		&lt;xsl:choose>			&lt;xsl:when test=\"contains($input, 'e')\">				&lt;xsl:variable name=\"man\" select=\"substring-before($input,'e')\" />				&lt;xsl:variable name=\"exp\" select=\"substring-after($input,'e')\" />				&lt;xsl:variable name=\"power\">					&lt;xsl:call-template name=\"PowersOf10\">						&lt;xsl:with-param name=\"exponent\" select=\"$exp\"/>					&lt;/xsl:call-template>				&lt;/xsl:variable>				&lt;!-- Offset depends on what we included above -->				&lt;xsl:value-of select=\"$man * $power\" />			&lt;/xsl:when>			&lt;xsl:otherwise>				&lt;xsl:value-of select=\"translate($num, '+', '')\" />			&lt;/xsl:otherwise>		&lt;/xsl:choose>	&lt;/xsl:template>		&lt;xsl:template name=\"PowersOf10\">		&lt;xsl:param name=\"exponent\"/>		&lt;xsl:choose>			 &lt;xsl:when test=\"$exponent=-9\">0.000000001&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=-8\">0.00000001&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=-7\">0.0000001&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=-6\">0.000001&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=-5\">0.00001&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=-4\">0.0001&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=-3\">0.001&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=-2\">0.01&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=-1\">0.1&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=0\">1&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=1\">10&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=2\">100&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=3\">1000&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=4\">10000&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=5\">100000&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=6\">1000000&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=7\">10000000&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=8\">100000000&lt;/xsl:when>			  &lt;xsl:when test=\"$exponent=9\">1000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=10\">10000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=11\">100000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=12\">1000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=13\">10000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=14\">100000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=15\">1000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=16\">10000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=17\">100000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=18\">1000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=19\">10000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=20\">100000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=21\">1000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=22\">10000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=23\">100000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=24\">1000000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=25\">10000000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=26\">100000000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=27\">1000000000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=28\">10000000000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=29\">100000000000000000000000000000&lt;/xsl:when>			 &lt;xsl:when test=\"$exponent=30\">1000000000000000000000000000000&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-30\">0.000000000000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-29\">0.00000000000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-28\">0.0000000000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-27\">0.000000000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-26\">0.00000000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-25\">0.0000000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-24\">0.000000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-23\">0.00000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-22\">0.0000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-21\">0.000000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-20\">0.00000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-19\">0.0000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-18\">0.000000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-17\">0.00000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-16\">0.0000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-15\">0.000000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-14\">0.00000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-13\">0.0000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-12\">0.000000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-11\">0.00000000001&lt;/xsl:when>			&lt;xsl:when test=\"$exponent=-10\">0.0000000001&lt;/xsl:when>			 &lt;xsl:otherwise>0&lt;/xsl:otherwise>		&lt;/xsl:choose>	&lt;/xsl:template>&lt;/xsl:stylesheet>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="NAME">voview.renderer_xsl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"&lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:vo=\"http://www.ivoa.net/xml/VOTable/v1.1\" xmlns:v1=\"http://vizier.u-strasbg.fr/VOTable\" xmlns:v2=\"http://vizier.u-strasbg.fr/xml/VOTable-1.1.xsd\" xmlns:v3=\"http://www.ivoa.net/xml/VOTable/v1.0\" xmlns:v4=\"http://www.ivoa.net/xml/VOTable/v1.2\" exclude-result-prefixes=\"vo v1 v2 v3 v4\">        &lt;!--&lt;xsl:output method=\"html\" doctype-public=\"-//W3C//DTD XHTML 1.0 Transitional//EN\"      doctype-system=\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"/>-->	&lt;xsl:output method=\"xml\"/>        &lt;!-- Sort VOTable by column sortOrder and write a page of rows in of HTML -->        &lt;!-- Input parameters -->        &lt;xsl:param name=\"selectedRows\">&lt;/xsl:param>    &lt;xsl:param name=\"selectRowUCD\">ID_MAIN&lt;/xsl:param>    &lt;xsl:param name=\"maxColumns\">11&lt;/xsl:param>    &lt;xsl:param name=\"columnOrder\"/>        &lt;xsl:param name=\"decPrecision\">10&lt;/xsl:param>    &lt;xsl:param name=\"raPrecision\">100&lt;/xsl:param>    &lt;xsl:param name=\"sexSeparator\">:&lt;/xsl:param>    &lt;xsl:param name=\"widgetIDprefix\">voview&lt;/xsl:param>        &lt;xsl:param name=\"renderPrefixColumn\">0&lt;/xsl:param>        &lt;xsl:param name=\"selectAllLabel\">Select All&lt;/xsl:param>        &lt;!-- Filter parameters -->    &lt;xsl:param name=\"filterText\">&lt;/xsl:param>    &lt;xsl:param name=\"filterForm\">filterForm&lt;/xsl:param>    &lt;xsl:param name=\"filterCallback\">filterByColumn&lt;/xsl:param>    &lt;xsl:param name=\"filterResetCallback\">resetFilter&lt;/xsl:param>    &lt;xsl:param name=\"filterRow\">filterRow&lt;/xsl:param>        &lt;xsl:param name=\"titleText\"/>        &lt;!-- Javascript callback functions (also settable as parameters) -->        &lt;xsl:param name=\"sortCallback\">sortTable&lt;/xsl:param>    &lt;xsl:param name=\"pageCallback\">newPage&lt;/xsl:param>    &lt;xsl:param name=\"setMaxColumnsCallback\">setMaxColumns&lt;/xsl:param>    &lt;xsl:param name=\"resetColumnOrderCallback\">resetColumnOrder&lt;/xsl:param>    &lt;xsl:param name=\"setPageLength\">setPageLength&lt;/xsl:param>    &lt;xsl:param name=\"selectRowCallback\">selectRow&lt;/xsl:param>    &lt;xsl:param name=\"selectAllRowsCallback\">selectAllRows&lt;/xsl:param>    &lt;xsl:param name=\"clearSelectionCallback\">clearRowSelection&lt;/xsl:param>    &lt;xsl:param name=\"clickClearCallback\">clickClear&lt;/xsl:param>    &lt;xsl:param name=\"clickResetCallback\">clickReset&lt;/xsl:param>        &lt;xsl:variable name=\"lc\" select=\"'abcdefghijklmnopqrstuvwxyz'\"/>    &lt;xsl:variable name=\"uc\" select=\"'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\"/>        &lt;!-- Computed variables -->        &lt;xsl:variable name=\"fieldlist\" select=\"//VOTABLE/RESOURCE/TABLE/FIELD|//vo:VOTABLE/vo:RESOURCE/vo:TABLE/vo:FIELD|//v1:VOTABLE/v1:RESOURCE/v1:TABLE/v1:FIELD|//v2:VOTABLE/v2:RESOURCE/v2:TABLE/v2:FIELD|//v3:VOTABLE/v3:RESOURCE/v3:TABLE/v3:FIELD|//v4:VOTABLE/v4:RESOURCE/v4:TABLE/v4:FIELD\"/>        &lt;xsl:variable name=\"paramlist\" select=\"//VOTABLE/RESOURCE/PARAM|//vo:VOTABLE/vo:RESOURCE/vo:PARAM|//v1:VOTABLE/v1:RESOURCE/v1:PARAM|//v2:VOTABLE/v2:RESOURCE/v2:PARAM|//v3:VOTABLE/v3:RESOURCE/v3:PARAM|//v4:VOTABLE/v4:RESOURCE/v4:PARAM\"/>&lt;!--    &lt;xsl:variable name=\"paramlist\" select=\"//PARAM|//vo:PARAM|//v1:PARAM|//v2:PARAM|//v3:PARAM|//v4:PARAM\"/>-->        &lt;xsl:variable name=\"useDescription\" select=\"name($fieldlist/*)='DESCRIPTION'\"/>    &lt;xsl:variable name=\"totalCount\" select=\"$paramlist[@ID='VOV:TotalCount']/@value\"/>    &lt;xsl:variable name=\"filterCount\" select=\"$paramlist[@ID='VOV:FilterCount']/@value\"/>    &lt;xsl:variable name=\"pageStart\" select=\"$paramlist[@ID='VOV:PageStart']/@value\"/>    &lt;xsl:variable name=\"pageEnd\" select=\"$paramlist[@ID='VOV:PageEnd']/@value\"/>    &lt;xsl:variable name=\"selectAllList\" select=\"$paramlist[@ID='VOV:SelectAllRows']/@value\"/>    &lt;xsl:variable name=\"sortColumnsList\" select=\"$paramlist[@ID='VOV:SortColumnsList']/@value\"/>        &lt;xsl:variable name=\"sortOrder\">    	&lt;xsl:choose>    		&lt;xsl:when test=\"substring($sortColumnsList,1,1) = '+'\">    			ascending    		&lt;/xsl:when>    		&lt;xsl:when test=\"substring($sortColumnsList,1,1) = '-'\">    			descending    		&lt;/xsl:when>    	&lt;/xsl:choose>    &lt;/xsl:variable>        &lt;xsl:variable name=\"sortColumn\" select=\"substring($sortColumnsList,2)\"/>    &lt;xsl:variable name=\"sortColumnNum\">        &lt;xsl:if test=\"$sortColumn != ''\">        	&lt;xsl:choose>        	&lt;xsl:when test=\"string(number($sortColumn))='NaN'\">            	&lt;xsl:call-template name=\"getColumnByName\">                	&lt;xsl:with-param name=\"value\" select=\"$sortColumn\"/>            	&lt;/xsl:call-template>            &lt;/xsl:when>            &lt;xsl:otherwise>				&lt;xsl:value-of select=\"number($sortColumn)\"/>            &lt;/xsl:otherwise>            &lt;/xsl:choose>        &lt;/xsl:if>    &lt;/xsl:variable>        &lt;xsl:variable name=\"sortName\">        &lt;xsl:choose>		        	&lt;xsl:when test=\"string(number($sortColumn))='NaN'\">    			&lt;xsl:value-of select=\"$sortColumn\"/>    		&lt;/xsl:when>    		&lt;xsl:otherwise>    			&lt;xsl:value-of select=\"$fieldlist[$sortColumn]/@name\"/>    		&lt;/xsl:otherwise>    	&lt;/xsl:choose>    &lt;/xsl:variable>    &lt;xsl:variable name=\"raColumnNum\">        &lt;xsl:call-template name=\"getColumnByUCDs\">            &lt;xsl:with-param name=\"value\" select=\"'|pos.eq.ra;meta.main|POS_EQ_RA_MAIN|'\"/>            &lt;xsl:with-param name=\"datatype\" select=\"'|float|double|'\"/>        &lt;/xsl:call-template>    &lt;/xsl:variable>        &lt;xsl:variable name=\"decColumnNum\">        &lt;xsl:call-template name=\"getColumnByUCDs\">            &lt;xsl:with-param name=\"value\" select=\"'|pos.eq.dec;meta.main|POS_EQ_DEC_MAIN|'\"/>            &lt;xsl:with-param name=\"datatype\" select=\"'|float|double|'\"/>        &lt;/xsl:call-template>    &lt;/xsl:variable>        &lt;xsl:variable name=\"urlColumnNum\">        &lt;xsl:call-template name=\"getColumnByUCD\">            &lt;xsl:with-param name=\"value\" select=\"'VOX:Image_AccessReference'\"/>        &lt;/xsl:call-template>    &lt;/xsl:variable>        &lt;xsl:variable name=\"formatColumnNum\">        &lt;xsl:call-template name=\"getColumnByUCD\">            &lt;xsl:with-param name=\"value\" select=\"'VOX:Image_Format'\"/>        &lt;/xsl:call-template>    &lt;/xsl:variable>        &lt;xsl:variable name=\"selectColumnNum\">        &lt;xsl:call-template name=\"getColumnByUCD\">            &lt;xsl:with-param name=\"value\" select=\"$selectRowUCD\"/>        &lt;/xsl:call-template>    &lt;/xsl:variable>        &lt;xsl:template name=\"getColumnByUCD\">        &lt;!-- THIS ASSUMED THAT THE COLUMN EXISTS! -->        &lt;!-- WHEN IT DOESN'T, SAFARI IS UNHAPPY! -->        &lt;xsl:param name=\"value\"/>        &lt;xsl:variable name='temp_column'>            &lt;xsl:for-each select=\"$fieldlist\">                &lt;xsl:if test=\"@ucd = $value\">                    &lt;xsl:value-of select=\"position()\"/>                &lt;/xsl:if>            &lt;/xsl:for-each>        &lt;/xsl:variable>        &lt;xsl:choose>            &lt;xsl:when test=\"$temp_column != ''\">                &lt;xsl:value-of select=\"$temp_column\"/>            &lt;/xsl:when>            &lt;xsl:otherwise>-1&lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;xsl:template name=\"getColumnByUCDs\">        &lt;xsl:param name=\"value\"/>        &lt;xsl:param name=\"datatype\"/>        &lt;xsl:for-each select=\"$fieldlist\">            &lt;xsl:if test=\"contains($value, concat('|',@ucd,'|')) and            (not($datatype) or contains($datatype,concat('|',@datatype,'|')))\">                &lt;xsl:value-of select=\"position()\"/>            &lt;/xsl:if>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;xsl:template name=\"getColumnByName\">        &lt;xsl:param name=\"value\"/>        &lt;xsl:variable name=\"tvalue\" select=\"translate($value,$lc,$uc)\"/>        &lt;xsl:for-each select=\"$fieldlist\">            &lt;xsl:variable name=\"ID\">                &lt;xsl:call-template name=\"getID\"/>            &lt;/xsl:variable>            &lt;xsl:if test=\"translate($ID,$lc,$uc) = $tvalue\">                &lt;xsl:value-of select=\"position()\"/>            &lt;/xsl:if>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;!-- ID is primary FIELD identifier (fall back to name if ID is not available) -->        &lt;xsl:template name=\"getID\">        &lt;xsl:choose>            &lt;xsl:when test=\"@ID\">                &lt;xsl:value-of select=\"@ID\"/>            &lt;/xsl:when>            &lt;xsl:otherwise>                &lt;xsl:value-of select=\"@name\"/>            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;!-- name is primary FIELD label (fall back to ID if name is not available) -->        &lt;xsl:template name=\"getName\">        &lt;xsl:choose>            &lt;xsl:when test=\"@name\">                &lt;xsl:value-of select=\"@name\"/>            &lt;/xsl:when>            &lt;xsl:otherwise>                &lt;xsl:value-of select=\"@ID\"/>            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;xsl:variable name=\"nrows\" select=\"count(/VOTABLE/RESOURCE/TABLE/DATA/TABLEDATA/TR|/vo:VOTABLE/vo:RESOURCE/vo:TABLE/vo:DATA/vo:TABLEDATA/vo:TR|/v1:VOTABLE/v1:RESOURCE/v1:TABLE/v1:DATA/v1:TABLEDATA/v1:TR|/v2:VOTABLE/v2:RESOURCE/v2:TABLE/v2:DATA/v2:TABLEDATA/v2:TR|/v3:VOTABLE/v3:RESOURCE/v3:TABLE/v3:DATA/v3:TABLEDATA/v3:TR|/v4:VOTABLE/v4:RESOURCE/v4:TABLE/v4:DATA/v4:TABLEDATA/v4:TR)\"/>        &lt;xsl:variable name=\"ncols\" select=\"count($fieldlist)\"/>        &lt;xsl:variable name=\"pageLength\">    	&lt;xsl:value-of select=\"number($pageEnd)-number($pageStart)+1\"/>    &lt;/xsl:variable>        &lt;xsl:variable name=\"page\">    	&lt;xsl:value-of select=\"ceiling(number($pageStart) div number($pageLength))\"/>    &lt;/xsl:variable>        &lt;xsl:variable name=\"npages\" select=\"ceiling($filterCount div $pageLength)\"/>    &lt;!-- process the VOTable -->        &lt;xsl:template name=\"start\" match=\"/\">        &lt;xsl:variable name=\"votable\" select=\"VOTABLE|vo:VOTABLE|v1:VOTABLE|v2:VOTABLE|v3:VOTABLE|v4:VOTABLE\"/>        &lt;xsl:for-each select=\"$votable\">            &lt;xsl:call-template name=\"votable\"/>        &lt;/xsl:for-each>        &lt;xsl:if test=\"count($votable)=0\">            &lt;xsl:call-template name=\"error\"/>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;!-- error template is called when root VOTABLE node is not found -->    	&lt;xsl:template name=\"error\">   		&lt;xsl:variable name=\"root\" select=\"name(*)\"/>   		&lt;xsl:variable name=\"ns1\" select=\"namespace-uri(*)\"/>   		&lt;xsl:variable name=\"ns\">      		&lt;xsl:if test=\"$ns1\"> {&lt;xsl:value-of select=\"$ns1\"/>} &lt;/xsl:if>   		&lt;/xsl:variable>   		&lt;h2>Error: Input is not a standard VOTable&lt;/h2>   		&lt;p>Root node is &lt;i> &lt;xsl:value-of select=\"$ns\"/> &lt;/i> &lt;b> &lt;xsl:value-of select=\"$root\"/> &lt;/b>&lt;/p>   		&lt;p>Should be &lt;b> VOTABLE &lt;/b> or &lt;i> {http://www.ivoa.net/xml/VOTable/v1.1} &lt;/i> &lt;b> VOTABLE &lt;/b>&lt;/p>	&lt;/xsl:template>        &lt;xsl:template name=\"votable\">        &lt;xsl:for-each select=\"INFO|vo:INFO|v1:INFO|v2:INFO|v3:INFO|v4:INFO\">            &lt;xsl:call-template name=\"info\"/>        &lt;/xsl:for-each>        &lt;xsl:for-each select=\"RESOURCE|vo:RESOURCE|v1:RESOURCE|v2:RESOURCE|v3:RESOURCE|v4:RESOURCE\">            &lt;xsl:call-template name=\"resource\"/>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;!-- Handle VOTable error return -->        &lt;xsl:template name=\"info\">        &lt;xsl:if test=\"@name='QUERY_STATUS' and @value='ERROR'\">            &lt;pre>                &lt;h2>                    &lt;xsl:value-of select=\".\"/>                &lt;/h2>            &lt;/pre>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;xsl:template name=\"resource\">    	&lt;!-- Begin dummy header 		&lt;html>		&lt;head>			&lt;title>VOTable Viewer&lt;/title>			&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"voview.css\">&lt;/link>		&lt;/head>		&lt;body>    	 End dummy header -->    	&lt;div>		&lt;xsl:attribute name=\"id\">&lt;xsl:value-of select=\"$widgetIDprefix\"/>.all&lt;/xsl:attribute>		&lt;!-- Because \"all\" contains all the other widgets, it needs to be last in the list -->		&lt;form name=\"widgets\" action=\"\">			&lt;input type=\"hidden\" name=\"widget_names\">				&lt;xsl:attribute name=\"value\">title,table,columnArranging,parameters,paging.top,paging.bottom,filterButtons,all&lt;/xsl:attribute>			&lt;/input>		&lt;/form>		&lt;h1 align=\"center\">    	    			&lt;span>				&lt;xsl:attribute name=\"id\">&lt;xsl:value-of select=\"$widgetIDprefix\"/>.title&lt;/xsl:attribute>   				&lt;xsl:value-of select=\"$titleText\"/>   			&lt;/span>   		&lt;/h1>		&lt;xsl:for-each select=\"TABLE|vo:TABLE|v1:TABLE|v2:TABLE|v3:TABLE|v4:TABLE\">			&lt;!-- 			 This is where the templates for the different sub-widgets are called			 -->     		&lt;xsl:call-template name=\"buttons\">				&lt;xsl:with-param name=\"location\" select=\"'top'\"/>			&lt;/xsl:call-template>            &lt;xsl:call-template name=\"dataNotes\"/>         	&lt;xsl:call-template name=\"dataTable\"/>            &lt;xsl:call-template name=\"buttons\">            	&lt;xsl:with-param name=\"location\" select=\"'bottom'\"/>            &lt;/xsl:call-template>		&lt;/xsl:for-each>        &lt;xsl:call-template name=\"fieldsparams\"/>        &lt;/div>      	&lt;!-- Begin dummy footer 		&lt;/body>		&lt;/html>    	 End dummy footer -->    &lt;/xsl:template>	&lt;xsl:template name=\"dataTable\">		&lt;!-- wrap entire table in a form for filtering -->		&lt;div>		&lt;xsl:attribute name=\"id\">&lt;xsl:value-of select=\"$widgetIDprefix\"/>.table&lt;/xsl:attribute>		&lt;form method=\"get\" name=\"{$filterForm}\"			onsubmit=\"return {$filterCallback}(this);\" onreset=\"return {$filterResetCallback}(this);\"			action=\"\">						&lt;div style=\"display:none\">				&lt;!-- hide the submit & reset buttons (where should they go?) -->				&lt;input type=\"submit\" class=\"submit\" name=\".submit\" value=\"Filter\"					title=\"Enter values for one or more columns in boxes\" />				&lt;input type=\"reset\" class=\"reset\" name=\".reset\" value=\"Clear\"					title=\"Clear column filter values\" />			&lt;/div>			&lt;table class=\"data\">				&lt;xsl:call-template name=\"columnSetting\" />				&lt;thead>					&lt;xsl:call-template name=\"header\">						&lt;xsl:with-param name=\"location\" select=\"'top'\" />					&lt;/xsl:call-template>				&lt;/thead>				&lt;!-- header repeats at bottom of table.				 HTML standard says tfoot must come before tbody -->				&lt;tfoot>					&lt;xsl:call-template name=\"header\">						&lt;xsl:with-param name=\"location\" select=\"'bottom'\" />					&lt;/xsl:call-template>				&lt;/tfoot>				&lt;tbody>					&lt;xsl:choose>						&lt;xsl:when test=\"$nrows=0\">							&lt;tr>								&lt;td colspan=\"{$maxColumns}\">									&lt;xsl:choose>										&lt;xsl:when test=\"$filterCount\">											&lt;h2>No results remain after filtering&lt;/h2>										&lt;/xsl:when>										&lt;xsl:otherwise>											&lt;h2>No results found&lt;/h2>										&lt;/xsl:otherwise>									&lt;/xsl:choose>								&lt;/td>							&lt;/tr>						&lt;/xsl:when>						&lt;xsl:otherwise>							&lt;xsl:apply-templates								select=\"DATA/TABLEDATA|vo:DATA/vo:TABLEDATA|v1:DATA/v1:TABLEDATA|v2:DATA/v2:TABLEDATA|v3:DATA/v3:TABLEDATA|v4:DATA/v4:TABLEDATA\" />						&lt;/xsl:otherwise>					&lt;/xsl:choose>				&lt;/tbody>			&lt;/table>		&lt;/form>		&lt;/div>	&lt;/xsl:template>        &lt;!--    Code gets replicated here for efficiency in selecting different namespaces.    I've abstracted what I can.  Is there a better way to code this?    -->        &lt;xsl:template match=\"DATA/TABLEDATA\">        &lt;xsl:for-each select=\"TR\">                &lt;xsl:call-template name=\"processIncludedRow\">                    &lt;xsl:with-param name=\"rowNum\" select=\"position()\"/>                    &lt;xsl:with-param name=\"TDlist\" select=\"TD\"/>                    &lt;xsl:with-param name=\"selector\" select=\"@vovid\"/>                &lt;/xsl:call-template>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;xsl:template match=\"vo:DATA/vo:TABLEDATA\">        &lt;xsl:for-each select=\"vo:TR\">                &lt;xsl:call-template name=\"processIncludedRow\">                    &lt;xsl:with-param name=\"rowNum\" select=\"position()\"/>                    &lt;xsl:with-param name=\"TDlist\" select=\"vo:TD\"/>                    &lt;xsl:with-param name=\"selector\" select=\"@vovid\"/>                &lt;/xsl:call-template>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;xsl:template match=\"v1:DATA/v1:TABLEDATA\">        &lt;xsl:for-each select=\"v1:TR\">                &lt;xsl:call-template name=\"processIncludedRow\">                    &lt;xsl:with-param name=\"rowNum\" select=\"position()\"/>                    &lt;xsl:with-param name=\"TDlist\" select=\"v1:TD\"/>                    &lt;xsl:with-param name=\"selector\" select=\"@vovid\"/>                &lt;/xsl:call-template>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;xsl:template match=\"v2:DATA/v2:TABLEDATA\">        &lt;xsl:for-each select=\"v2:TR\">                &lt;xsl:call-template name=\"processIncludedRow\">                    &lt;xsl:with-param name=\"rowNum\" select=\"position()\"/>                    &lt;xsl:with-param name=\"TDlist\" select=\"v2:TD\"/>                    &lt;xsl:with-param name=\"selector\" select=\"@vovid\"/>                &lt;/xsl:call-template>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;xsl:template match=\"v3:DATA/v3:TABLEDATA\">        &lt;xsl:for-each select=\"v3:TR\">                &lt;xsl:call-template name=\"processIncludedRow\">                    &lt;xsl:with-param name=\"rowNum\" select=\"position()\"/>                    &lt;xsl:with-param name=\"TDlist\" select=\"v3:TD\"/>                    &lt;xsl:with-param name=\"selector\" select=\"@vovid\"/>                &lt;/xsl:call-template>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;xsl:template match=\"v4:DATA/v4:TABLEDATA\">        &lt;xsl:for-each select=\"v4:TR\">                &lt;xsl:call-template name=\"processIncludedRow\">                    &lt;xsl:with-param name=\"rowNum\" select=\"position()\"/>                    &lt;xsl:with-param name=\"TDlist\" select=\"v4:TD\"/>                    &lt;xsl:with-param name=\"selector\" select=\"@vovid\"/>                &lt;/xsl:call-template>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;xsl:template name=\"processIncludedRow\">        &lt;xsl:param name=\"rowNum\"/>        &lt;xsl:param name=\"TDlist\"/>        &lt;xsl:param name=\"selector\"/>        &lt;!--  xsl:variable name=\"selector\" select=\"string($TDlist[position()=$selectColumnNum])\"/ -->        &lt;tr id=\"vov_{$selector}\" onclick=\"{$selectRowCallback}(this,'{$selector}',event)\">            &lt;xsl:attribute name=\"class\">                &lt;xsl:call-template name=\"isSelected\">                    &lt;xsl:with-param name=\"selector\" select=\"$selector\"/>                &lt;/xsl:call-template>                &lt;xsl:choose>                    &lt;xsl:when test=\"($rowNum mod 2) = 0\">even&lt;/xsl:when>                    &lt;xsl:otherwise>odd&lt;/xsl:otherwise>                &lt;/xsl:choose>            &lt;/xsl:attribute>            &lt;xsl:variable name=\"isSelected\">                &lt;xsl:call-template name=\"isSelected\">                    &lt;xsl:with-param name=\"selector\" select=\"$selector\"/>                &lt;/xsl:call-template>            &lt;/xsl:variable>            &lt;xsl:call-template name=\"processRow\">                &lt;xsl:with-param name=\"TDlist\" select=\"$TDlist\"/>                &lt;xsl:with-param name=\"format\" select=\"(TD|vo:TD|v1:TD|v2:TD|v3:TD|v4:TD)[position()=$formatColumnNum]\"/>                &lt;xsl:with-param name=\"selector\" select=\"$selector\"/>            &lt;/xsl:call-template>        &lt;/tr>    &lt;/xsl:template>        &lt;!-- create tables describing FIELDs and PARAMs -->        &lt;xsl:template name=\"fieldsparams\">        &lt;xsl:for-each select=\"TABLE|vo:TABLE|v1:TABLE|v2:TABLE|v3:TABLE|v4:TABLE\">            &lt;table>                &lt;tbody>                    &lt;tr valign=\"top\">                        &lt;td>                            &lt;xsl:call-template name=\"fieldstable\"/>                        &lt;/td>                        &lt;td>                            &lt;xsl:call-template name=\"paramstable\"/>                        &lt;/td>                    &lt;/tr>                &lt;/tbody>            &lt;/table>        &lt;/xsl:for-each>    &lt;/xsl:template>        &lt;xsl:template name=\"fieldstable\">    	&lt;div class=\"fieldparam\">    	&lt;xsl:attribute name=\"id\">&lt;xsl:value-of select=\"$widgetIDprefix\"/>.columnArranging&lt;/xsl:attribute>        &lt;h2>            Columns        &lt;/h2>        &lt;span class=\"bbox rightbutton\" onclick=\"{$resetColumnOrderCallback}();\" title=\"Restore original column order\">Reset&#160;column&#160;order&lt;/span>        &lt;table class=\"fields\" id=\"voview_column_fields\">            &lt;col/>            &lt;col/>            &lt;col/>            &lt;xsl:if test=\"$useDescription\">                &lt;col width=\"400\"/>            &lt;/xsl:if>            &lt;thead>&lt;tr>                    &lt;th>Name&lt;/th>                    &lt;th>Unit&lt;/th>                    &lt;th>Datatype&lt;/th>                    &lt;xsl:if test=\"$useDescription\">                        &lt;th>Description&lt;/th>                    &lt;/xsl:if>                &lt;/tr>&lt;/thead>            &lt;tbody>                &lt;xsl:choose>                    &lt;xsl:when test=\"$columnOrder\">                        &lt;xsl:call-template name=\"fieldIter\">                            &lt;xsl:with-param name=\"count\" select=\"1\"/>                            &lt;xsl:with-param name=\"colnums\" select=\"$columnOrder\"/>                        &lt;/xsl:call-template>                    &lt;/xsl:when>                    &lt;xsl:otherwise>                        &lt;xsl:for-each select=\"$fieldlist\">                            &lt;xsl:variable name=\"row\" select=\"position()\"/>                            &lt;xsl:call-template name=\"fieldrow\">                                &lt;xsl:with-param name=\"row\" select=\"$row\"/>                                &lt;xsl:with-param name=\"posit\" select=\"$row\"/>                            &lt;/xsl:call-template>                        &lt;/xsl:for-each>                    &lt;/xsl:otherwise>                &lt;/xsl:choose>            &lt;/tbody>        &lt;/table>        &lt;/div>    &lt;/xsl:template>        &lt;xsl:template name=\"paramstable\">        &lt;xsl:if test=\"count($paramlist) &gt; 0\">        	&lt;div class=\"fieldparam\">	    	&lt;xsl:attribute name=\"id\">&lt;xsl:value-of select=\"$widgetIDprefix\"/>.parameters&lt;/xsl:attribute>            &lt;h2>Table Parameters&lt;/h2>            &lt;table class=\"parameters\">                &lt;thead>&lt;tr>                        &lt;th>Name&lt;/th>                        &lt;th>Value&lt;/th>                        &lt;th>Unit&lt;/th>                    &lt;/tr>&lt;/thead>                &lt;tbody>                    &lt;xsl:for-each select=\"$paramlist\">                        &lt;tr>                            &lt;td>                                &lt;xsl:call-template name=\"getName\"/>                            &lt;/td>                            &lt;td>                                &lt;xsl:value-of select=\"@value\"/>                            &lt;/td>                            &lt;td>                                &lt;xsl:value-of select=\"@unit\"/>                            &lt;/td>                        &lt;/tr>                    &lt;/xsl:for-each>                &lt;/tbody>            &lt;/table>            &lt;/div>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;!-- recursive template to loop over fields in columnOrder -->        &lt;xsl:template name=\"fieldIter\">        &lt;xsl:param name=\"count\"/>        &lt;xsl:param name=\"colnums\"/>        &lt;xsl:if test=\"$colnums\">            &lt;xsl:variable name=\"posit\" select=\"number(substring-before($colnums,','))\"/>            &lt;xsl:for-each select=\"$fieldlist[position()=$posit]\">                &lt;xsl:call-template name=\"fieldrow\">                    &lt;xsl:with-param name=\"row\" select=\"$count\"/>                    &lt;xsl:with-param name=\"posit\" select=\"$posit\"/>                &lt;/xsl:call-template>            &lt;/xsl:for-each>            &lt;xsl:call-template name=\"fieldIter\">                &lt;xsl:with-param name=\"count\" select=\"1+$count\"/>                &lt;xsl:with-param name=\"colnums\" select=\"substring-after($colnums,',')\"/>            &lt;/xsl:call-template>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;xsl:template name=\"fieldrow\">        &lt;xsl:param name=\"row\"/>        &lt;xsl:param name=\"posit\"/>        &lt;tr id=\"fieldrow_{$posit}\">            &lt;xsl:attribute name=\"class\">                &lt;xsl:choose>                    &lt;xsl:when test=\"($row mod 2) = 0\">even&lt;/xsl:when>                    &lt;xsl:otherwise>odd&lt;/xsl:otherwise>                &lt;/xsl:choose>            &lt;/xsl:attribute>            &lt;td>                &lt;xsl:call-template name=\"getName\"/>            &lt;/td>            &lt;td>                &lt;xsl:value-of select=\"@unit\"/>            &lt;/td>            &lt;td>                &lt;xsl:value-of select=\"@datatype\"/>                &lt;xsl:if test=\"@arraysize\">                    &lt;xsl:value-of select=\"concat('[',@arraysize,']')\"/>                &lt;/xsl:if>            &lt;/td>            &lt;xsl:if test=\"$useDescription\">                &lt;td>                    &lt;xsl:value-of select=\"DESCRIPTION|vo:DESCRIPTION|v1:DESCRIPTION|v2:DESCRIPTION|v3:DESCRIPTION|v4:DESCRIPTION\"/>                &lt;/td>            &lt;/xsl:if>        &lt;/tr>        &lt;!--        &lt;td>&lt;xsl:value-of select=\"$row\"/>:&lt;xsl:value-of select=\"$ncols\"/>:&lt;xsl:value-of select=\"$maxColumns\"/>&lt;/td>        \"Hidden\" bar did not show initially when $ncols &lt; $maxColumns ...        &lt;xsl:if test=\"$row=$maxColumns\">        -->        &lt;xsl:if test=\"$row=$maxColumns or ( $row=$ncols and $maxColumns &gt; $ncols )\">            &lt;tr class=\"separator\">                &lt;td colspan=\"5\" align=\"center\">Columns below are hidden - Drag to change&lt;/td>            &lt;/tr>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;!-- all the page buttons -->        &lt;xsl:template name=\"buttons\">        &lt;xsl:param name=\"location\"/>        &lt;div class=\"buttons {$location}\">           	&lt;xsl:attribute name=\"id\">&lt;xsl:value-of select=\"$widgetIDprefix\"/>.paging.&lt;xsl:value-of select=\"$location\"/>&lt;/xsl:attribute>            &lt;div class=\"pagelabel\">            	&lt;xsl:variable name=\"realEnd\">            		&lt;xsl:choose>            			&lt;xsl:when test=\"$pageEnd &lt; $filterCount\">            				&lt;xsl:value-of select=\"$pageEnd\"/>            			&lt;/xsl:when>            			&lt;xsl:otherwise>            				&lt;xsl:value-of select=\"$filterCount\"/>            			&lt;/xsl:otherwise>            		&lt;/xsl:choose>            	&lt;/xsl:variable>            	&lt;xsl:choose>            		&lt;xsl:when test=\"$realEnd != 0\">		                Results &lt;b>&lt;xsl:value-of select=\"$pageStart\"/>-&lt;xsl:value-of select=\"$realEnd\"/>&lt;/b>		                &lt;xsl:if test=\"$npages != 1 or $filterCount\"> of &lt;b>&lt;xsl:value-of select=\"$filterCount\"/>&lt;/b>&lt;/xsl:if>            		&lt;/xsl:when>            		&lt;xsl:otherwise>            			Zero results            		&lt;/xsl:otherwise>            	&lt;/xsl:choose>                &lt;xsl:if test=\"$totalCount\">                    (&lt;b>&lt;xsl:value-of select=\"$totalCount\"/>&lt;/b> before filtering)                &lt;/xsl:if>                &lt;xsl:if test=\"$sortColumnNum != ''\">sorted by &lt;b>&lt;xsl:value-of select=\"$sortName\"/>&lt;/b>                &lt;/xsl:if>            &lt;/div>            &lt;xsl:if test=\"$npages != 1\">                &lt;div class=\"pagebuttons\">                    &lt;xsl:call-template name=\"onePage\">                        &lt;xsl:with-param name=\"value\" select=\"number($page)-1\"/>                        &lt;xsl:with-param name=\"label\" select=\"'Previous'\"/>                        &lt;xsl:with-param name=\"class\" select=\"'rev'\"/>                    &lt;/xsl:call-template>                    &lt;xsl:choose>                        &lt;xsl:when test=\"$npages &lt; 12\">                            &lt;xsl:call-template name=\"pageRun\">                                &lt;xsl:with-param name=\"start\" select=\"1\"/>                                &lt;xsl:with-param name=\"end\" select=\"$npages\"/>                            &lt;/xsl:call-template>                        &lt;/xsl:when>                        &lt;xsl:when test=\"number($page) &lt; 7\">                            &lt;xsl:call-template name=\"pageRun\">                                &lt;xsl:with-param name=\"start\" select=\"1\"/>                                &lt;xsl:with-param name=\"end\" select=\"9\"/>                            &lt;/xsl:call-template>                            &#8230;                            &lt;xsl:call-template name=\"onePage\">                                &lt;xsl:with-param name=\"value\" select=\"$npages\"/>		                        &lt;xsl:with-param name=\"label\" select=\"''\"/>		                        &lt;xsl:with-param name=\"class\" select=\"''\"/>                            &lt;/xsl:call-template>                        &lt;/xsl:when>                        &lt;xsl:when test=\"number($page)+6 &gt; $npages\">                            &lt;xsl:call-template name=\"onePage\">                                &lt;xsl:with-param name=\"value\" select=\"1\"/>		                        &lt;xsl:with-param name=\"label\" select=\"''\"/>		                        &lt;xsl:with-param name=\"class\" select=\"''\"/>                            &lt;/xsl:call-template>                            &#8230;                            &lt;xsl:call-template name=\"pageRun\">                                &lt;xsl:with-param name=\"start\" select=\"number($npages)-8\"/>                                &lt;xsl:with-param name=\"end\" select=\"$npages\"/>                            &lt;/xsl:call-template>                        &lt;/xsl:when>                        &lt;xsl:otherwise>                            &lt;xsl:call-template name=\"onePage\">                                &lt;xsl:with-param name=\"value\" select=\"1\"/>		                        &lt;xsl:with-param name=\"label\" select=\"''\"/>		                        &lt;xsl:with-param name=\"class\" select=\"''\"/>                            &lt;/xsl:call-template>                            &#8230;                            &lt;xsl:call-template name=\"pageRun\">                                &lt;xsl:with-param name=\"start\" select=\"number($page)-3\"/>                                &lt;xsl:with-param name=\"end\" select=\"number($page)+3\"/>                            &lt;/xsl:call-template>                            &#8230;                            &lt;xsl:call-template name=\"onePage\">                                &lt;xsl:with-param name=\"value\" select=\"$npages\"/>		                        &lt;xsl:with-param name=\"label\" select=\"''\"/>		                        &lt;xsl:with-param name=\"class\" select=\"''\"/>                            &lt;/xsl:call-template>                        &lt;/xsl:otherwise>                    &lt;/xsl:choose>                    &lt;xsl:call-template name=\"onePage\">                        &lt;xsl:with-param name=\"value\" select=\"number($page)+1\"/>                        &lt;xsl:with-param name=\"label\" select=\"'Next'\"/>                        &lt;xsl:with-param name=\"class\" select=\"'fwd'\"/>                    &lt;/xsl:call-template>                &lt;/div>            &lt;/xsl:if>            &lt;xsl:call-template name=\"pageLengthControl\">                &lt;xsl:with-param name=\"location\" select=\"$location\"/>            &lt;/xsl:call-template>        &lt;/div>    &lt;/xsl:template>        &lt;xsl:template name=\"onePage\">        &lt;xsl:param name=\"value\"/>        &lt;xsl:param name=\"label\"/>        &lt;xsl:param name=\"class\"/>        &lt;xsl:variable name=\"plabel\">            &lt;xsl:choose>                &lt;xsl:when test=\"$label=''\">&lt;xsl:value-of select=\"$value\"/>&lt;/xsl:when>                &lt;xsl:otherwise>&lt;xsl:value-of select=\"$label\"/>&lt;/xsl:otherwise>            &lt;/xsl:choose>        &lt;/xsl:variable>        &lt;xsl:text>        &lt;/xsl:text>        &lt;xsl:choose>            &lt;xsl:when test=\"$value &lt; 1 or $value &gt; $npages\">                &lt;span class=\"button {$class} inactive\">&lt;xsl:value-of select=\"$plabel\"/>&lt;/span>            &lt;/xsl:when>            &lt;xsl:when test=\"$page=$value\">                &lt;b>&lt;xsl:value-of select=\"$plabel\"/>&lt;/b>            &lt;/xsl:when>            &lt;xsl:otherwise>            	&lt;a href=\"#\" onclick=\"return {$pageCallback}({$value})\">                    &lt;span class=\"button {$class}\">&lt;xsl:value-of select=\"$plabel\"/>&lt;/span>            	&lt;/a>            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;xsl:template name=\"pageRun\">        &lt;xsl:param name=\"start\"/>        &lt;xsl:param name=\"end\"/>        &lt;xsl:call-template name=\"onePage\">            &lt;xsl:with-param name=\"value\" select=\"$start\"/>            &lt;xsl:with-param name=\"label\" select=\"''\"/>            &lt;xsl:with-param name=\"class\" select=\"''\"/>        &lt;/xsl:call-template>        &lt;xsl:if test=\"$start &lt; $end\">            &lt;xsl:call-template name=\"pageRun\">                &lt;xsl:with-param name=\"start\" select=\"number($start)+1\"/>                &lt;xsl:with-param name=\"end\" select=\"$end\"/>            &lt;/xsl:call-template>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;xsl:template name=\"pageLengthControl\">        &lt;xsl:param name=\"location\"/>        &lt;div class=\"pageLengthControl\">            Show            &lt;select name=\"pagesize-{$location}\" onchange=\"{$setPageLength}(this.value)\">                &lt;option value=\"10\">                    &lt;xsl:if test=\"number($pageLength)=10\">                        &lt;xsl:attribute name=\"selected\">selected&lt;/xsl:attribute>                    &lt;/xsl:if>                    10                &lt;/option>                &lt;option value=\"20\">                    &lt;xsl:if test=\"number($pageLength)=20\">                        &lt;xsl:attribute name=\"selected\">selected&lt;/xsl:attribute>                    &lt;/xsl:if>                    20                &lt;/option>                &lt;option value=\"50\">                    &lt;xsl:if test=\"number($pageLength)=50\">                        &lt;xsl:attribute name=\"selected\">selected&lt;/xsl:attribute>                    &lt;/xsl:if>                    50                &lt;/option>                &lt;option value=\"100\">                    &lt;xsl:if test=\"number($pageLength)=100\">                        &lt;xsl:attribute name=\"selected\">selected&lt;/xsl:attribute>                    &lt;/xsl:if>                    100                &lt;/option>            &lt;/select>            results per page        &lt;/div>    &lt;/xsl:template>        &lt;xsl:template name=\"dataNotes\">		&lt;div class=\"searchnote\">		   &lt;xsl:attribute name=\"id\">&lt;xsl:value-of select=\"$widgetIDprefix\"/>.filterButtons&lt;/xsl:attribute>		   &lt;xsl:if test=\"$renderPrefixColumn = 1\">           		Click column heading to sort list - Click rows to select           		&lt;span class=\"bbox\" onclick=\"{$clearSelectionCallback}();\">Reset&#160;selection&lt;/span>           		&lt;br />           &lt;/xsl:if>           Text boxes under columns select matching rows           &lt;span class=\"bbox\" onclick=\"return {$filterCallback}(document.{$filterForm});\">Apply Filter&lt;/span>           &lt;span class=\"bbox\" onclick=\"return {$filterResetCallback}(document.{$filterForm});\">Clear Filter&lt;/span>           &lt;br />         &lt;/div>    &lt;/xsl:template>            &lt;!-- template setting column properties can be overridden by importing stylesheet -->        &lt;xsl:template name=\"columnSetting\"/>        &lt;!-- column headers come from VOTable FIELDS -->        &lt;xsl:template name=\"header\">        &lt;xsl:param name=\"location\"/>        &lt;tr>            &lt;xsl:call-template name=\"prefix-header\">                &lt;xsl:with-param name=\"location\" select=\"$location\"/>            &lt;/xsl:call-template>            &lt;xsl:choose>                &lt;xsl:when test=\"$columnOrder\">                    &lt;xsl:call-template name=\"headerIter\">                        &lt;xsl:with-param name=\"count\" select=\"1\"/>                        &lt;xsl:with-param name=\"colnums\" select=\"$columnOrder\"/>                        &lt;xsl:with-param name=\"location\" select=\"$location\"/>                    &lt;/xsl:call-template>                &lt;/xsl:when>                &lt;xsl:otherwise>                    &lt;xsl:for-each select=\"$fieldlist\">                        &lt;xsl:variable name=\"posit\" select=\"position()\"/>                        &lt;xsl:if test=\"$posit &lt;= $maxColumns\">                            &lt;xsl:call-template name=\"columnheader\">                                &lt;xsl:with-param name=\"posit\" select=\"$posit\"/>		                        &lt;xsl:with-param name=\"location\" select=\"$location\"/>                            &lt;/xsl:call-template>                        &lt;/xsl:if>                    &lt;/xsl:for-each>                &lt;/xsl:otherwise>            &lt;/xsl:choose>            &lt;xsl:if test=\"$ncols &gt; 1 and $maxColumns &gt; 1\">                &lt;th onclick=\"{$setMaxColumnsCallback}({$maxColumns - 1})\" title=\"Click to show fewer columns\">&#171;&lt;/th>            &lt;/xsl:if>            &lt;xsl:if test=\"$ncols &gt; $maxColumns\">                &lt;th onclick=\"{$setMaxColumnsCallback}({$maxColumns + 1})\" title=\"Click to show more columns\">&#187;&lt;/th>            &lt;/xsl:if>        &lt;/tr>        &lt;xsl:if test=\"$location='top'\">            &lt;tr id=\"{$filterRow}\">                &lt;xsl:call-template name=\"prefix-filter\">                    &lt;xsl:with-param name=\"location\" select=\"$location\"/>                &lt;/xsl:call-template>                &lt;xsl:choose>                    &lt;xsl:when test=\"$columnOrder\">                        &lt;xsl:call-template name=\"filterIter\">                            &lt;xsl:with-param name=\"count\" select=\"1\"/>                            &lt;xsl:with-param name=\"colnums\" select=\"$columnOrder\"/>                        &lt;/xsl:call-template>                    &lt;/xsl:when>                    &lt;xsl:otherwise>                        &lt;xsl:for-each select=\"$fieldlist\">                            &lt;xsl:variable name=\"posit\" select=\"position()\"/>                            &lt;xsl:if test=\"$posit &lt;= $maxColumns\">                                &lt;xsl:call-template name=\"filterbox\">                                    &lt;xsl:with-param name=\"posit\" select=\"$posit\"/>                                &lt;/xsl:call-template>                            &lt;/xsl:if>                        &lt;/xsl:for-each>                    &lt;/xsl:otherwise>                &lt;/xsl:choose>            &lt;/tr>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;!-- recursive template to loop over fields in columnOrder -->        &lt;xsl:template name=\"headerIter\">        &lt;xsl:param name=\"count\"/>        &lt;xsl:param name=\"colnums\"/>        &lt;xsl:param name=\"location\"/>        &lt;xsl:if test=\"$colnums and $count &lt;= $maxColumns\">            &lt;xsl:variable name=\"posit\" select=\"number(substring-before($colnums,','))\"/>            &lt;xsl:for-each select=\"$fieldlist[position()=$posit]\">                &lt;xsl:call-template name=\"columnheader\">                    &lt;xsl:with-param name=\"posit\" select=\"$posit\"/>                    &lt;xsl:with-param name=\"location\" select=\"$location\"/>                &lt;/xsl:call-template>            &lt;/xsl:for-each>            &lt;xsl:call-template name=\"headerIter\">                &lt;xsl:with-param name=\"count\" select=\"1+$count\"/>                &lt;xsl:with-param name=\"colnums\" select=\"substring-after($colnums,',')\"/>                &lt;xsl:with-param name=\"location\" select=\"$location\"/>            &lt;/xsl:call-template>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;xsl:template name=\"columnheader\">        &lt;xsl:param name=\"posit\"/>        &lt;xsl:param name=\"location\"/>        &lt;xsl:variable name=\"ID\">            &lt;xsl:call-template name=\"getID\"/>        &lt;/xsl:variable>        &lt;xsl:variable name=\"name\">            &lt;xsl:call-template name=\"getName\"/>        &lt;/xsl:variable>        &lt;xsl:choose>            &lt;xsl:when test=\"$posit = $urlColumnNum\">                &lt;th class=\"unsortable\" id=\"{$ID}_{$posit}_{$location}\">                    &lt;xsl:value-of select=\"$name\"/>                &lt;/th>            &lt;/xsl:when>            &lt;xsl:otherwise>                &lt;th onclick=\"{$sortCallback}(this)\" id=\"{$ID}_{$posit}_{$location}\">                    &lt;xsl:attribute name=\"title\">                        &lt;xsl:variable name=\"descr\"                         select=\"DESCRIPTION|vo:DESCRIPTION|v1:DESCRIPTION|v2:DESCRIPTION|v3:DESCRIPTION|v4:DESCRIPTION\"/>                        &lt;xsl:choose>                            &lt;xsl:when test=\"$descr\">                                &lt;xsl:value-of select=\"concat($descr,' (click to sort)')\"/>                            &lt;/xsl:when>                            &lt;xsl:otherwise>                                &lt;xsl:value-of select=\"concat('Click to sort by ',$name)\"/>                            &lt;/xsl:otherwise>                        &lt;/xsl:choose>                    &lt;/xsl:attribute>                    &lt;xsl:if test=\"translate($ID,$lc,$uc)=translate($sortName,$lc,$uc)\">                        &lt;xsl:attribute name=\"class\">                            &lt;xsl:value-of select=\"$sortOrder\"/>                        &lt;/xsl:attribute>                    &lt;/xsl:if>                    &lt;xsl:value-of select=\"$name\"/>                &lt;/th>            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;xsl:template name=\"prefix-header\">        &lt;xsl:param name=\"location\"/>        &lt;xsl:choose>            &lt;xsl:when test=\"$renderPrefixColumn = 1\">                &lt;th>                    select                &lt;/th>            &lt;/xsl:when>            &lt;xsl:when test=\"$renderPrefixColumn = 2\">                &lt;th>                &lt;/th>            &lt;/xsl:when>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;!-- recursive template to loop over fields in columnOrder -->        &lt;xsl:template name=\"filterIter\">        &lt;xsl:param name=\"count\"/>        &lt;xsl:param name=\"colnums\"/>        &lt;xsl:if test=\"$colnums and $count &lt;= $maxColumns\">            &lt;xsl:variable name=\"posit\" select=\"number(substring-before($colnums,','))\"/>            &lt;xsl:for-each select=\"$fieldlist[position()=$posit]\">                &lt;xsl:call-template name=\"filterbox\">                    &lt;xsl:with-param name=\"posit\" select=\"$posit\"/>                &lt;/xsl:call-template>            &lt;/xsl:for-each>            &lt;xsl:call-template name=\"filterIter\">                &lt;xsl:with-param name=\"count\" select=\"1+$count\"/>                &lt;xsl:with-param name=\"colnums\" select=\"substring-after($colnums,',')\"/>            &lt;/xsl:call-template>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;xsl:template name=\"filterbox\">        &lt;xsl:param name=\"posit\"/>        &lt;td>            &lt;xsl:if test=\"$posit != $urlColumnNum and (@datatype='char' or not(@arraysize)  or @arraysize=1)\">                &lt;xsl:variable name=\"isChar\" select=\"@datatype='char' or @datatype='string'\"/>                &lt;xsl:variable name=\"defaultComment\">                	&lt;xsl:choose>                		&lt;xsl:when test=\"$isChar\">String&lt;/xsl:when>						&lt;xsl:otherwise>Number&lt;/xsl:otherwise>					&lt;/xsl:choose>                &lt;/xsl:variable>                &lt;xsl:variable name=\"filterSep\" select=\"concat('|',$posit,':')\"/>                &lt;input type=\"hidden\" name=\"vovfilter{$posit}_type\" value=\"{$isChar}\"/>                &lt;input type=\"text\" name=\"vovfilter{$posit}\">                    &lt;xsl:attribute name=\"title\">                        &lt;xsl:choose>                            &lt;xsl:when test=\"$isChar\">String: abc (exact match) or *ab*c* , ! to negate&lt;/xsl:when>                            &lt;xsl:otherwise>Number: 10 or >=10 or 10..20 for a range , ! to negate&lt;/xsl:otherwise>                        &lt;/xsl:choose>                    &lt;/xsl:attribute>                    &lt;xsl:attribute name=\"value\">                        &lt;xsl:choose>                        	&lt;xsl:when test=\"contains($filterText,$filterSep)\">                            	&lt;xsl:value-of select=\"substring-before(substring-after($filterText,$filterSep),'|')\"/>                        	&lt;/xsl:when>                        	&lt;xsl:otherwise>                        		&lt;xsl:value-of select=\"$defaultComment\"/>                        	&lt;/xsl:otherwise>                        &lt;/xsl:choose>                    &lt;/xsl:attribute>                    &lt;xsl:attribute name=\"class\">                        &lt;xsl:choose>                        	&lt;xsl:when test=\"contains($filterText,$filterSep)\">filter&lt;/xsl:when>                        	&lt;xsl:otherwise>filter defaultComment&lt;/xsl:otherwise>                        &lt;/xsl:choose>											&lt;/xsl:attribute>                                        &lt;xsl:attribute name=\"onclick\">                    	&lt;xsl:value-of select=\"$clickClearCallback\"/>(this, '&lt;xsl:value-of select=\"$defaultComment\"/>');                    &lt;/xsl:attribute>                    &lt;xsl:attribute name=\"onblur\">                    	&lt;xsl:value-of select=\"$clickResetCallback\"/>(this, '&lt;xsl:value-of select=\"$defaultComment\"/>');                    &lt;/xsl:attribute>                &lt;/input>            &lt;/xsl:if>        &lt;/td>    &lt;/xsl:template>        &lt;xsl:template name=\"prefix-filter\">        &lt;xsl:param name=\"location\"/>        &lt;xsl:choose>            &lt;xsl:when test=\"$renderPrefixColumn = 1\">                &lt;td title=\"Click to select all rows\" class=\"bbox\">                    &lt;xsl:attribute name=\"onclick\">                        &lt;xsl:value-of select=\"$selectAllRowsCallback\"/>(this);                    &lt;/xsl:attribute>                    &lt;input type=\"hidden\" name=\"select_all_rows\">                        &lt;xsl:attribute name=\"value\">                            &lt;xsl:value-of select=\"$selectAllList\"/>                        &lt;/xsl:attribute>                    &lt;/input>                    &lt;xsl:value-of select=\"$selectAllLabel\"/>                &lt;/td>            &lt;/xsl:when>            &lt;xsl:when test=\"$renderPrefixColumn = 2\">                &lt;td>                &lt;/td>            &lt;/xsl:when>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;xsl:template name=\"processRow\">        &lt;xsl:param name=\"TDlist\"/>        &lt;xsl:param name=\"format\"/>        &lt;xsl:param name=\"selector\"/>                &lt;xsl:call-template name=\"prefix-column\">            &lt;xsl:with-param name=\"ident\" select=\"$selector\"/>            &lt;xsl:with-param name=\"format\" select=\"$format\"/>        &lt;/xsl:call-template>        &lt;xsl:choose>            &lt;xsl:when test=\"$columnOrder\">                &lt;xsl:call-template name=\"columnIter\">                    &lt;xsl:with-param name=\"count\" select=\"1\"/>                    &lt;xsl:with-param name=\"colnums\" select=\"$columnOrder\"/>                    &lt;xsl:with-param name=\"TDlist\" select=\"$TDlist\"/>                &lt;/xsl:call-template>            &lt;/xsl:when>            &lt;xsl:otherwise>                &lt;xsl:for-each select=\"$TDlist\">                    &lt;xsl:variable name=\"posit\" select=\"position()\"/>                    &lt;xsl:if test=\"$posit &lt;= $maxColumns\">                        &lt;xsl:call-template name=\"processColumn\">                            &lt;xsl:with-param name=\"TDlist\" select=\"$TDlist\"/>                            &lt;xsl:with-param name=\"posit\" select=\"$posit\"/>                        &lt;/xsl:call-template>                    &lt;/xsl:if>                &lt;/xsl:for-each>            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;xsl:template name=\"prefix-column\">        &lt;xsl:param name=\"ident\"/>        &lt;xsl:param name=\"format\"/>                &lt;xsl:choose>            &lt;xsl:when test=\"$renderPrefixColumn = 1\">                &lt;td>                    &lt;input id=\"cb-{$ident}\" type=\"checkbox\" name=\"cb-{$ident}\" value=\"cb-{$ident}\">                        &lt;xsl:variable name=\"isSelected\">                            &lt;xsl:call-template name=\"isSelected\">                                &lt;xsl:with-param name=\"selector\" select=\"$ident\"/>                            &lt;/xsl:call-template>                        &lt;/xsl:variable>                        &lt;xsl:if test=\"$isSelected = $selectedvalue\">                            &lt;xsl:attribute name=\"checked\"/>                        &lt;/xsl:if>                    &lt;/input>                    &lt;label for=\"cb-{$ident}\">                    &lt;/label>                &lt;/td>            &lt;/xsl:when>            &lt;xsl:when test=\"$renderPrefixColumn = 2\">                &lt;td>                &lt;/td>            &lt;/xsl:when>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;!-- recursive template to loop over columns in columnOrder -->        &lt;xsl:template name=\"columnIter\">        &lt;xsl:param name=\"count\"/>        &lt;xsl:param name=\"colnums\"/>        &lt;xsl:param name=\"TDlist\"/>        &lt;xsl:if test=\"$colnums and $count &lt;= $maxColumns\">            &lt;xsl:variable name=\"posit\" select=\"number(substring-before($colnums,','))\"/>            &lt;xsl:for-each select=\"$TDlist[position()=$posit]\">                &lt;xsl:call-template name=\"processColumn\">                    &lt;xsl:with-param name=\"TDlist\" select=\"$TDlist\"/>                    &lt;xsl:with-param name=\"posit\" select=\"$posit\"/>                &lt;/xsl:call-template>            &lt;/xsl:for-each>            &lt;xsl:call-template name=\"columnIter\">                &lt;xsl:with-param name=\"count\" select=\"1+$count\"/>                &lt;xsl:with-param name=\"colnums\" select=\"substring-after($colnums,',')\"/>                &lt;xsl:with-param name=\"TDlist\" select=\"$TDlist\"/>            &lt;/xsl:call-template>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;xsl:template name=\"processColumn\">        &lt;xsl:param name=\"TDlist\"/>        &lt;xsl:param name=\"posit\"/>        &lt;td>            &lt;!--            For show and debugging            -->            &lt;xsl:attribute name='val'>                &lt;xsl:value-of select=\"@val\"/>            &lt;/xsl:attribute>            &lt;xsl:choose>                &lt;xsl:when test=\"$posit = $urlColumnNum\">                    &lt;xsl:call-template name=\"processURL\">                        &lt;xsl:with-param name=\"TDlist\" select=\"$TDlist\"/>                    &lt;/xsl:call-template>                &lt;/xsl:when>                &lt;xsl:when test=\"$posit = $decColumnNum\">                    &lt;xsl:call-template name=\"processSex\">                        &lt;xsl:with-param name=\"precision\" select=\"$decPrecision\"/>                        &lt;xsl:with-param name=\"scale\" select=\"'1'\"/>                    &lt;/xsl:call-template>                &lt;/xsl:when>                &lt;xsl:when test=\"$posit = $raColumnNum\">                    &lt;xsl:call-template name=\"processSex\">                        &lt;xsl:with-param name=\"precision\" select=\"$raPrecision\"/>                        &lt;xsl:with-param name=\"scale\" select=\"'15'\"/>                    &lt;/xsl:call-template>                &lt;/xsl:when>                &lt;xsl:otherwise>                    &lt;!-- Trim long columns (need to make this show full text if clicked)  -->                    &lt;xsl:choose>                        &lt;xsl:when test=\"substring(.,101) and not(contains(.,'&lt;'))\">                            &lt;xsl:value-of select=\"concat(substring(.,1,97),'...')\"/>                        &lt;/xsl:when>                        &lt;!--                        added the arraysize check to make them show up on                        the same line when there was an array                        some people may prefer the other way                        -->                        &lt;xsl:when test=\"contains('|float|int|double|',concat('|',$fieldlist[position()=$posit]/@datatype,'|')) and not($fieldlist[position()=$posit]/@arraysize)\">                            &lt;xsl:value-of select=\".\"/>                        &lt;/xsl:when>                        &lt;xsl:otherwise>                            &lt;!-- replace spaces with non-breaking spaces -->                            &lt;xsl:call-template name=\"replace\"/>                        &lt;/xsl:otherwise>                    &lt;/xsl:choose>                &lt;/xsl:otherwise>            &lt;/xsl:choose>        &lt;/td>    &lt;/xsl:template>        &lt;xsl:template name=\"replace\">        &lt;xsl:param name=\"text-string\" select=\".\"/>        &lt;xsl:param name=\"find-word\" select=\"' '\"/>        &lt;xsl:param name=\"replace-with\" select=\"'&#160;'\"/>        &lt;xsl:choose>            &lt;xsl:when test=\"contains($text-string,$find-word)\">                &lt;xsl:call-template name=\"replace\">                    &lt;xsl:with-param name=\"text-string\" select=\"concat(substring-before($text-string,$find-word),$replace-with,substring-after($text-string,$find-word))\"/>                    &lt;xsl:with-param name=\"find-word\" select=\"$find-word\"/>                    &lt;xsl:with-param name=\"replace-with\" select=\"$replace-with\"/>                &lt;/xsl:call-template>            &lt;/xsl:when>            &lt;xsl:otherwise>                &lt;xsl:value-of select=\"$text-string\"/>            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>            &lt;xsl:template name=\"processURL\">        &lt;xsl:param name=\"TDlist\"/>        &lt;xsl:variable name=\"format\" select=\"$TDlist[position()=$formatColumnNum]\"/>        &lt;xsl:variable name=\"href\" select=\"normalize-space(.)\"/>        &lt;xsl:variable name=\"sformat\" select=\"translate(substring-after($format,'/'),$lc,$uc)\"/>        &lt;xsl:variable name=\"label\">            &lt;xsl:choose>                &lt;xsl:when test=\"$sformat\">                    &lt;xsl:value-of select=\"$sformat\"/>                &lt;/xsl:when>                &lt;xsl:otherwise>Link&lt;/xsl:otherwise>            &lt;/xsl:choose>        &lt;/xsl:variable>        &lt;a href=\"{$href}\" target=\"_blank\">            &lt;xsl:value-of select=\"$label\"/>        &lt;/a>    &lt;/xsl:template>        &lt;!-- Convert to sexagesimal format dd:mm:ss -->        &lt;xsl:template name=\"processSex\">        &lt;xsl:param name=\"precision\">10&lt;/xsl:param>        &lt;xsl:param name=\"scale\">1&lt;/xsl:param>        &lt;xsl:variable name=\"original\">            &lt;xsl:choose>                &lt;xsl:when test=\"@val\">                    &lt;xsl:value-of select=\"translate(@val,'+','')\"/>                &lt;/xsl:when>                &lt;xsl:otherwise>                    &lt;!-- Some tables have a leading + which causes problems, so remove it -->                    &lt;xsl:value-of select=\"translate(.,'+','')\"/>                &lt;/xsl:otherwise>            &lt;/xsl:choose>        &lt;/xsl:variable>        &lt;xsl:choose>            &lt;xsl:when test=\"string-length(normalize-space($original)) &gt; 0\">                &lt;xsl:variable name=\"numb\" select=\"number($original)\"/>                &lt;xsl:variable name=\"absnumb\"                 select=\"round((1-2*($numb &lt; 0))*$numb*3600*$precision div $scale + 0.5)\"/>                                &lt;xsl:variable name=\"degr\"                 select=\"floor($absnumb div (3600*$precision))\"/>                                &lt;xsl:variable name=\"mn\"                 select=\"floor(($absnumb - $degr*3600*$precision) div (60*$precision))\"/>                &lt;xsl:variable name=\"sc\"                 select=\"($absnumb - $precision*(3600*$degr + 60*$mn)) div $precision\"/>                &lt;xsl:if test=\"$numb &lt; 0\">-&lt;/xsl:if>                &lt;xsl:value-of select=\"concat(format-number($degr,'00'), $sexSeparator, format-number($mn,'00'), $sexSeparator, format-number($sc, '00.0##'))\"/>            &lt;/xsl:when>            &lt;xsl:otherwise>                ---            &lt;/xsl:otherwise>        &lt;/xsl:choose>    &lt;/xsl:template>        &lt;!--    Returns $selectedvalue if the selector is in the comma-delimited    list of selectedRows.    Stupid Xpath 1.0 does not have the $*(#@ ends-with function, so have to    check that by hand.    -->        &lt;xsl:variable name=\"selectedvalue\">selectedimage&lt;/xsl:variable>        &lt;xsl:template name=\"isSelected\">        &lt;xsl:param name=\"selector\"/>        &lt;xsl:if test=\"$selectedRows\">            &lt;xsl:choose>                &lt;xsl:when test=\"$selector = $selectedRows or contains($selectedRows,concat(',',$selector,',')) or starts-with($selectedRows,concat($selector,','))\">                    &lt;xsl:value-of select=\"$selectedvalue\"/>                &lt;/xsl:when>                &lt;xsl:otherwise>                    &lt;xsl:call-template name=\"endswithSelected\">                        &lt;xsl:with-param name=\"selector\" select=\"concat(',',$selector)\"/>                        &lt;xsl:with-param name=\"sparam\" select=\"$selectedRows\"/>                    &lt;/xsl:call-template>                &lt;/xsl:otherwise>            &lt;/xsl:choose>        &lt;/xsl:if>    &lt;/xsl:template>        &lt;xsl:template name=\"endswithSelected\">        &lt;xsl:param name=\"selector\"/>        &lt;xsl:param name=\"sparam\"/>        &lt;xsl:if test=\"contains($sparam,$selector)\">            &lt;xsl:variable name=\"tail\" select=\"substring-after($sparam,$selector)\"/>            &lt;xsl:choose>                &lt;xsl:when test=\"$tail\">                    &lt;xsl:call-template name=\"endswithSelected\">                        &lt;xsl:with-param name=\"selector\" select=\"$selector\"/>                        &lt;xsl:with-param name=\"sparam\" select=\"$tail\"/>                    &lt;/xsl:call-template>                &lt;/xsl:when>                &lt;xsl:otherwise>                    &lt;xsl:value-of select=\"$selectedvalue\"/>                &lt;/xsl:otherwise>            &lt;/xsl:choose>        &lt;/xsl:if>    &lt;/xsl:template>    &lt;/xsl:stylesheet>"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1174</span> </span></pre></body></html>